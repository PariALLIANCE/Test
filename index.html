<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pari Alliance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            /* Thème par défaut (bleu) */
            --primary-color: #5D5CDE;
            --text-color: #000000;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --secondary-color: #f0f2f5;
            --chat-sent-bg: #5D5CDE;
            --chat-sent-text: #ffffff;
            --chat-received-bg: #f0f2f5;
            --selection-color: rgba(93, 92, 222, 0.3);
            --action-menu-bg: rgba(0, 0, 0, 0.9);
            --action-menu-text: #ffffff;
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(255, 255, 255, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.1);
            --group-icon-bg: #4CAF50;
            --danger-color: #ff4842;
            --success-color: #4caf50;
            --input-bg: #f0f2f5;
            --input-placeholder: #8e8e93;
            --button-text: #000000;
            --inactive-text: #8e8e93;
            --link-color: #007aff;
            --admin-badge-bg: #5D5CDE;
            --admin-badge-text: white;
            --log-bg: rgba(0, 0, 0, 0.8);
            --log-text: #ffffff;
            --log-info: #2196F3;
            --log-warning: #FFC107;
            --log-error: #FF5252;
            --log-success: #4CAF50;
            --overlay-bg: rgba(0, 0, 0, 0.7);
            --event-bg: #f1f1f1;
            --event-border: #e0e0e0;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #ffffff;
            --side-menu-active: #f0f2f5;
            --side-menu-hover: #f5f5f5;
            --log-panel-bg: #f8f9fa;
            --log-panel-border: #e0e0e0;
            --link-hover: #0056b3;
            --admin-notif-bg: #f8f9fa;
            --admin-notif-border: #e0e0e0;
            --forecast-win-bg: rgba(76, 175, 80, 0.2);
            --forecast-loss-bg: rgba(244, 67, 54, 0.2);
            --forecast-pending-bg: rgba(255, 193, 7, 0.2);
            --comment-bg: #f5f5f5;
            --comment-border: #ebebeb;
            --social-whatsapp: #25D366;
            --social-telegram: #0088cc;
            --social-youtube: #FF0000;
            --partner-google: #4285F4;
            --partner-firebase: #FFCA28;
            --partner-github: #333333;
            --partner-quora: #B92B27;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.1);
            --warning-text: #FF9800;
            --image-message-bg: rgba(93, 92, 222, 0.1);
            --image-viewer-bg: rgba(0, 0, 0, 0.9);
            --selected-message-border: rgba(93, 92, 222, 0.7);
            --date-separator-bg: rgba(0, 0, 0, 0.05);
            --date-separator-text: var(--inactive-text);
            --reply-preview-bg: rgba(93, 92, 222, 0.1);
            --reply-preview-border: var(--primary-color);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(0, 0, 0, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: var(--bg-color);
            --action-bar-text: var(--text-color);
            --action-bar-border: var(--border-color);
            --reply-quote-bg: rgba(93, 92, 222, 0.15);
            --reply-quote-border: var(--primary-color);
            --group-info-bg: var(--bg-color);
            --group-info-border: var(--border-color);
            --download-btn-bg: var(--primary-color);
            --download-btn-text: white;
            --new-badge-bg: var(--primary-color);
            --new-badge-text: white;
            --theme-selector-border: #ddd;
            --user-item-bg: var(--bg-color);
            --unread-badge-bg: #FF4842;
            --unread-badge-text: white;
            --sats-color: #F7931A;
            --plan-active-bg: rgba(93, 92, 222, 0.1);
            --plan-active-border: var(--primary-color);
            --premium-badge-bg: #FFD700;
            --premium-badge-text: #000000;
            --history-date-bg: rgba(93, 92, 222, 0.1);
            --history-date-text: var(--primary-color);
            --card-bg: var(--secondary-color);
            --card-accent: var(--primary-color);
        }
        
        /* Thème vert */
        .theme-green {
            --primary-color: #4CAF50;
            --chat-sent-bg: #4CAF50;
            --selection-color: rgba(76, 175, 80, 0.3);
            --admin-badge-bg: #4CAF50;
            --reply-preview-bg: rgba(76, 175, 80, 0.1);
            --reply-preview-border: #4CAF50;
            --reply-quote-bg: rgba(76, 175, 80, 0.15);
            --reply-quote-border: #4CAF50;
            --download-btn-bg: #4CAF50;
            --new-badge-bg: #4CAF50;
            --image-message-bg: rgba(76, 175, 80, 0.1);
            --selected-message-border: rgba(76, 175, 80, 0.7);
            --history-date-bg: rgba(76, 175, 80, 0.1);
            --history-date-text: #4CAF50;
            --card-accent: #4CAF50;
        }
        
        /* Thème rouge */
        .theme-red {
            --primary-color: #F44336;
            --chat-sent-bg: #F44336;
            --selection-color: rgba(244, 67, 54, 0.3);
            --admin-badge-bg: #F44336;
            --reply-preview-bg: rgba(244, 67, 54, 0.1);
            --reply-preview-border: #F44336;
            --reply-quote-bg: rgba(244, 67, 54, 0.15);
            --reply-quote-border: #F44336;
            --download-btn-bg: #F44336;
            --new-badge-bg: #F44336;
            --image-message-bg: rgba(244, 67, 54, 0.1);
            --selected-message-border: rgba(244, 67, 54, 0.7);
            --history-date-bg: rgba(244, 67, 54, 0.1);
            --history-date-text: #F44336;
            --card-accent: #F44336;
        }
        
        /* Thème orange */
        .theme-orange {
            --primary-color: #FF9800;
            --chat-sent-bg: #FF9800;
            --selection-color: rgba(255, 152, 0, 0.3);
            --admin-badge-bg: #FF9800;
            --reply-preview-bg: rgba(255, 152, 0, 0.1);
            --reply-preview-border: #FF9800;
            --reply-quote-bg: rgba(255, 152, 0, 0.15);
            --reply-quote-border: #FF9800;
            --download-btn-bg: #FF9800;
            --new-badge-bg: #FF9800;
            --image-message-bg: rgba(255, 152, 0, 0.1);
            --selected-message-border: rgba(255, 152, 0, 0.7);
            --history-date-bg: rgba(255, 152, 0, 0.1);
            --history-date-text: #FF9800;
            --card-accent: #FF9800;
        }

        /* Nouveau thème rouge-rose */
        .theme-red-pink {
            --primary-color: #E91E63;
            --chat-sent-bg: linear-gradient(135deg, #F44336, #E91E63);
            --selection-color: rgba(233, 30, 99, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --reply-preview-bg: rgba(233, 30, 99, 0.1);
            --reply-preview-border: #E91E63;
            --reply-quote-bg: rgba(233, 30, 99, 0.15);
            --reply-quote-border: #E91E63;
            --download-btn-bg: linear-gradient(135deg, #F44336, #E91E63);
            --new-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --image-message-bg: rgba(233, 30, 99, 0.1);
            --selected-message-border: rgba(233, 30, 99, 0.7);
            --history-date-bg: rgba(233, 30, 99, 0.1);
            --history-date-text: #E91E63;
            --card-accent: #E91E63;
        }

        /* Nouveau thème vert-jaune */
        .theme-green-yellow {
            --primary-color: #8BC34A;
            --chat-sent-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --selection-color: rgba(139, 195, 74, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --reply-preview-bg: rgba(139, 195, 74, 0.1);
            --reply-preview-border: #8BC34A;
            --reply-quote-bg: rgba(139, 195, 74, 0.15);
            --reply-quote-border: #8BC34A;
            --download-btn-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --new-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --image-message-bg: rgba(139, 195, 74, 0.1);
            --selected-message-border: rgba(139, 195, 74, 0.7);
            --history-date-bg: rgba(139, 195, 74, 0.1);
            --history-date-text: #8BC34A;
            --card-accent: #8BC34A;
        }

        /* Nouveau thème bleu-violet */
        .theme-blue-purple {
            --primary-color: #673AB7;
            --chat-sent-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --selection-color: rgba(103, 58, 183, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --reply-preview-bg: rgba(103, 58, 183, 0.1);
            --reply-preview-border: #673AB7;
            --reply-quote-bg: rgba(103, 58, 183, 0.15);
            --reply-quote-border: #673AB7;
            --download-btn-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --new-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --image-message-bg: rgba(103, 58, 183, 0.1);
            --selected-message-border: rgba(103, 58, 183, 0.7);
            --history-date-bg: rgba(103, 58, 183, 0.1);
            --history-date-text: #673AB7;
            --card-accent: #673AB7;
        }

        /* Nouveau thème orange-doré */
        .theme-orange-gold {
            --primary-color: #FF8F00;
            --chat-sent-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --selection-color: rgba(255, 143, 0, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --reply-preview-bg: rgba(255, 143, 0, 0.1);
            --reply-preview-border: #FF8F00;
            --reply-quote-bg: rgba(255, 143, 0, 0.15);
            --reply-quote-border: #FF8F00;
            --download-btn-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --new-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --image-message-bg: rgba(255, 143, 0, 0.1);
            --selected-message-border: rgba(255, 143, 0, 0.7);
            --history-date-bg: rgba(255, 143, 0, 0.1);
            --history-date-text: #FF8F00;
            --card-accent: #FF8F00;
        }

        /* Nouveaux thèmes */
        .theme-purple {
            --primary-color: #9C27B0;
            --card-accent: #9C27B0;
        }

        .theme-teal {
            --primary-color: #009688;
            --card-accent: #009688;
        }

        .theme-indigo {
            --primary-color: #3F51B5;
            --card-accent: #3F51B5;
        }

        .theme-pink {
            --primary-color: #E91E63;
            --card-accent: #E91E63;
        }

        .theme-cyan {
            --primary-color: #00BCD4;
            --card-accent: #00BCD4;
        }

        .theme-lime {
            --primary-color: #CDDC39;
            --card-accent: #CDDC39;
        }

        .theme-amber {
            --primary-color: #FFC107;
            --card-accent: #FFC107;
        }

        .theme-deep-orange {
            --primary-color: #FF5722;
            --card-accent: #FF5722;
        }

        /* Styles de couleur pour les cartes */
        .card-style-gradient .forecast-item {
            background: linear-gradient(135deg, var(--secondary-color), rgba(93, 92, 222, 0.1));
        }

        .card-style-glass .forecast-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-style-shadow .forecast-item {
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .card-style-neon .forecast-item {
            border: 2px solid var(--card-accent);
            box-shadow: 0 0 20px rgba(93, 92, 222, 0.3);
        }

        /* Mode High-Tech */
        .theme-hightech {
            --bg-color: #0a0a0a;
            --text-color: #00ff88;
            --primary-color: #00ff88;
            --secondary-color: #1a1a1a;
            --border-color: #00ff88;
            --card-bg: rgba(0, 255, 136, 0.1);
            --card-accent: #00ff88;
            --input-bg: #1a1a1a;
            --inactive-text: #66ff99;
            --side-menu-bg: #0a0a0a;
            --side-menu-active: #1a1a1a;
            --admin-badge-bg: #00ff88;
            --admin-badge-text: #000000;
            background-image: 
                linear-gradient(90deg, rgba(0, 255, 136, 0.1) 1px, transparent 1px),
                linear-gradient(rgba(0, 255, 136, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
        }

        /* Animation des circuits pour le mode high-tech */
        .theme-hightech::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 60% 10%, rgba(0, 255, 136, 0.05) 0%, transparent 40%);
            animation: circuit-flow 8s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes circuit-flow {
            0%, 100% { opacity: 0.3; transform: translateX(0) translateY(0); }
            25% { opacity: 0.6; transform: translateX(10px) translateY(-5px); }
            50% { opacity: 0.8; transform: translateX(-5px) translateY(10px); }
            75% { opacity: 0.4; transform: translateX(5px) translateY(-10px); }
        }

        /* Cartes high-tech avec lueur */
        .theme-hightech .forecast-item {
            background: rgba(0, 255, 136, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.3);
            box-shadow: 
                0 0 20px rgba(0, 255, 136, 0.2),
                inset 0 1px 0 rgba(0, 255, 136, 0.1);
            position: relative;
            overflow: hidden;
        }

        .theme-hightech .forecast-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            animation: scan-line 3s ease-in-out infinite;
        }

        @keyframes scan-line {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .theme-hightech .forecast-item:hover {
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.4),
                inset 0 1px 0 rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.6);
        }

        /* Texte brillant en mode high-tech */
        .theme-hightech .forecast-header,
        .theme-hightech .header-title,
        .theme-hightech .nav-item.active {
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .dark {
            --bg-color: #181818;
            --text-color: #ffffff;
            --border-color: #3e4042;
            --secondary-color: #2c2c2c;
            --chat-received-bg: #2c2c2c;
            --chat-sent-text: #ffffff;
            --selection-color: rgba(93, 92, 222, 0.4);
            --action-menu-bg: rgba(60, 60, 60, 0.95);
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(40, 40, 40, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.3);
            --group-icon-bg: #388E3C;
            --danger-color: #ff6b6b;
            --success-color: #66bb6a;
            --input-bg: #2c2c2c;
            --input-placeholder: #6c6c6c;
            --link-color: #2196F3;
            --admin-badge-text: white;
            --log-bg: rgba(20, 20, 20, 0.9);
            --log-info: #64B5F6;
            --log-warning: #FFD54F;
            --log-error: #FF8A80;
            --log-success: #81C784;
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --event-bg: #2a2a2a;
            --event-border: #3e3e3e;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #222222;
            --side-menu-active: #333333;
            --side-menu-hover: #2a2a2a;
            --log-panel-bg: #222222;
            --log-panel-border: #3e3e3e;
            --link-hover: #64B5F6;
            --admin-notif-bg: #2a2a2a;
            --admin-notif-border: #333333;
            --forecast-win-bg: rgba(76, 175, 80, 0.15);
            --forecast-loss-bg: rgba(244, 67, 54, 0.15);
            --forecast-pending-bg: rgba(255, 193, 7, 0.15);
            --comment-bg: #2a2a2a;
            --comment-border: #333333;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.15);
            --warning-text: #FFA726;
            --image-message-bg: rgba(93, 92, 222, 0.15);
            --image-viewer-bg: rgba(0, 0, 0, 0.95);
            --selected-message-border: rgba(93, 92, 222, 0.8);
            --date-separator-bg: rgba(255, 255, 255, 0.1);
            --date-separator-text: #aaaaaa;
            --reply-preview-bg: rgba(93, 92, 222, 0.15);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(255, 255, 255, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: #222222;
            --action-bar-text: #ffffff;
            --action-bar-border: #3e3e3e;
            --reply-quote-bg: rgba(93, 92, 222, 0.2);
            --group-info-bg: #222222;
            --group-info-border: #3e3e3e;
            --download-btn-text: white;
            --theme-selector-border: #444;
            --user-item-bg: #222222;
            --plan-active-bg: rgba(93, 92, 222, 0.15);
            --history-date-bg: rgba(93, 92, 222, 0.15);
            --card-bg: #2c2c2c;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            position: fixed;
            overflow: hidden;
            font-weight: 500;
            letter-spacing: -0.2px;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -250px;
            height: 100%;
            width: 250px;
            background-color: var(--side-menu-bg);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            border-bottom: none;
        }
        
        .side-menu-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 15px;
        }
        
        .side-menu-close {
            font-size: 20px;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
        }
        
        .side-menu-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .side-menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .side-menu-item.active {
            background-color: var(--side-menu-active);
        }
        
        .side-menu-item i {
            font-size: 20px;
            width: 30px;
            color: var(--primary-color);
        }
        
        .side-menu-text {
            margin-left: 15px;
            font-weight: 500;
        }
        
        .side-menu-footer {
            margin-top: auto;
        }
        
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .side-menu-overlay.active {
            display: block;
        }
        
        .header {
            background-color: var(--bg-color);
            border-bottom: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header.search-active {
            height: 50px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            transition: opacity 0.3s ease;
        }
        
        .header-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            border-bottom: none;
            text-decoration: none;
            transition: opacity 0.3s ease;
            flex: 1;
        }
        
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
            transition: opacity 0.3s ease;
        }
        
        .menu-button, .back-button, .search-button, .events-button, .info-button, .select-button {
            padding: 8px;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .menu-button:active, .back-button:active, .search-button:active, .events-button:active, .info-button:active, .select-button:active {
            background-color: var(--secondary-color);
        }
        
        .notification-dot {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background-color: var(--notification-dot);
            border-radius: 50%;
            display: none;
        }
        
        .notification-dot.active {
            display: block;
        }
        
        .events-button {
            position: relative;
        }
        
        .search-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            padding: 0 15px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 20;
        }
        
        .search-container.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 18px;
            border: none;
            background-color: var(--secondary-color);
            font-size: 16px;
            color: var(--text-color);
            outline: none;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }
        
        .search-close {
            padding: 8px;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-close:active {
            background-color: var(--secondary-color);
        }
        
        .header.search-active .header-left,
        .header.search-active .header-title,
        .header.search-active #header-action {
            opacity: 0;
            pointer-events: none;
        }

        /* Debug log panel */
        .debug-log-panel {
            position: fixed;
            bottom: 80px;
            left: 10px;
            right: 10px;
            max-height: 200px;
            background-color: var(--log-panel-bg);
            border: 1px solid var(--log-panel-border);
            border-radius: 8px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .debug-log-panel.active {
            display: flex;
        }

        .debug-log-header {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-log-close {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.2s ease;
        }

        .debug-log-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .debug-log-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .debug-log-item {
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .debug-log-item.error {
            background-color: rgba(244, 67, 54, 0.1);
            border-left-color: var(--log-error);
            color: var(--log-error);
        }

        .debug-log-item.warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: var(--log-warning);
            color: var(--log-warning);
        }

        .debug-log-item.info {
            background-color: rgba(33, 150, 243, 0.1);
            border-left-color: var(--log-info);
            color: var(--log-info);
        }

        .debug-log-item.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left-color: var(--log-success);
            color: var(--log-success);
        }

        .debug-log-timestamp {
            font-size: 10px;
            opacity: 0.7;
            margin-right: 5px;
        }

        .debug-log-link {
            color: var(--link-color);
            text-decoration: underline;
            cursor: pointer;
            word-break: break-all;
        }

        .debug-log-link:hover {
            color: var(--link-hover);
        }

        .debug-toggle-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--log-error);
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }

        .debug-toggle-btn.active {
            display: flex;
        }

        .debug-toggle-btn:hover {
            transform: scale(1.1);
        }
        
        .content {
            position: fixed;
            top: 50px;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow: hidden;
            background-color: var(--bg-color);
        }
        
        .content.no-bottom-nav {
            bottom: 0;
        }
        
        .bottom-nav {
            background-color: var(--bg-color);
            border-top: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            z-index: 10;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: var(--inactive-text);
            font-size: 10px;
            cursor: pointer;
            height: 100%;
            padding: 8px 0;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        .section {
            padding: 0;
            display: none;
            height: 100%;
            overflow: hidden;
        }
        
        .section.active {
            display: flex;
            flex-direction: column;
        }
        
        .profile-pic {
            width: 50px;
            height: 50px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-pic-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }
        
        .profile-pic-edit:hover, .profile-pic-edit:active {
            transform: scale(1.1);
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        
        .loading-spinner {
            font-size: 60px;
            color: var(--primary-color);
            animation: pulse 2s infinite, bounce 1.5s infinite;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .settings-container {
            padding: 15px;
            overflow-y: auto;
            height: 100%;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: none;
            cursor: pointer;
        }
        
        .setting-icon {
            width: 36px;
            height: 36px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .setting-label {
            font-weight: 500;
        }
        
        .button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.15s ease, opacity 0.2s ease, background-color 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .button:hover {
            background-color: #4a49c0;
        }

        .button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
        }
        
        .button.danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .button.danger:hover {
            background-color: #e53935;
        }

        .button.claim {
            background-color: var(--success-color);
            color: white;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .button.claim:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .profile-header {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border-bottom: none;
        }
        
        .profile-header .profile-pic {
            width: 80px;
            height: 80px;
            margin-right: 20px;
        }
        
        .profile-header .profile-pic i {
            font-size: 30px;
            color: var(--primary-color);
        }
        
        .profile-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .profile-name {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .profile-email {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .profile-status {
            color: #6b7280;
        }
        
        .profile-edit {
            color: var(--primary-color);
            font-size: 14px;
            margin-top: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 8px;
            border-radius: 15px;
        }
        
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .auth-header {
            padding: 40px 0 20px;
            text-align: center;
        }
        
        .auth-logo {
            font-size: 50px;
            color: var(--primary-color);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .auth-subtitle {
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 20px;
            padding: 0 20px;
            text-align: center;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: none;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
            text-decoration: none;
            border-bottom: none;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        .auth-form {
            padding: 20px;
            display: none;
            animation: fadeUp 0.5s ease;
        }
        
        @keyframes fadeUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            font-size: 16px;
            color: var(--text-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            outline: none;
        }
        
        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.25);
        }
        
        .form-input::placeholder {
            color: var(--input-placeholder);
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 13px;
            margin-top: 6px;
            display: none;
            animation: shakeX 0.75s ease;
        }
        
        @keyframes shakeX {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        .form-footer {
            margin-top: 30px;
            text-align: center;
        }
        
        .form-footer-text {
            margin-top: 15px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .form-link {
            color: var(--link-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }
        
        .form-link:hover {
            text-decoration: underline;
        }

        .log-message {
            margin-top: 15px;
            padding: 12px;
            font-weight: bold;
            border-radius: 6px;
            white-space: pre-line;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
          
        .log-message.info {
            background: #d1ecf1;
            color: #0c5460;
        }
          
        .log-message.success {
            background: #d4edda;
            color: #155724;
        }
          
        .log-message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--inactive-text);
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--border-color);
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .btn-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .button.loading {
            pointer-events: none;
            opacity: 0.8;
        }
        
        .button.loading .btn-text {
            visibility: hidden;
        }
        
        .button.loading .btn-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -10px;
            visibility: visible;
        }
        
        .notification {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-weight: 500;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            line-height: 1.4;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .notification.success {
            background-color: var(--bg-color);
            color: var(--success-color);
        }

        .notification.error {
            background-color: var(--bg-color);
            color: var(--danger-color);
        }

        .notification.info {
            background-color: var(--bg-color);
            color: var(--primary-color);
        }
        
        .verify-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .football-bounce {
            font-size: 80px;
            color: var(--primary-color);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-40px); }
            60% { transform: translateY(-20px); }
        }

        .verify-text {
            margin-top: 30px;
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            text-align: center;
        }
        
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--bg-color);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 85%;
            max-width: 300px;
            padding: 20px;
            z-index: 150;
            display: none;
        }
        
        .confirmation-dialog.active {
            display: block;
        }
        
        .confirmation-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .confirmation-text {
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }
        
        .confirmation-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .confirmation-button {
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            min-width: 100px;
            text-align: center;
        }
        
        .confirmation-cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        .confirmation-confirm {
            background-color: var(--primary-color);
            color: white;
        }
        
        .confirmation-delete {
            background-color: var(--danger-color);
            color: white;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 90;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }

        .event-icon {
            width: 50px;
            height: 50px;
            background-color: var(--event-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            border: 1px solid var(--event-border);
        }
        
        .event-icon i {
            font-size: 22px;
            color: var(--primary-color);
        }

        .event-item {
            transition: none;
            cursor: default;
            position: relative;
        }

        .event-header {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-content {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .event-time {
            font-size: 12px;
            color: var(--inactive-text);
            margin-top: 5px;
        }
        
        .admin-badge {
            display: inline-block;
            background-color: var(--admin-badge-bg);
            color: var(--admin-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .premium-badge {
            display: inline-block;
            background-color: var(--premium-badge-bg);
            color: var(--premium-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .restricted-badge {
            display: inline-block;
            background-color: var(--restricted-badge-bg);
            color: var(--restricted-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .new-badge {
            display: inline-block;
            background-color: var(--new-badge-bg);
            color: var(--new-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .admin-count-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            margin-left: 6px;
        }

        .event-item.group-create .event-icon {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .event-item.group-create .event-icon i {
            color: var(--success-color);
        }
        
        .event-item.permission-change .event-icon {
            background-color: rgba(255, 193, 7, 0.2);
        }
        
        .event-item.permission-change .event-icon i {
            color: var(--restricted-badge-bg);
        }
        
        .event-item.user-join .event-icon {
            background-color: rgba(33, 150, 243, 0.2);
        }
        
        .event-item.user-join .event-icon i {
            color: var(--log-info);
        }

        .restricted-message {
            text-align: center;
            padding: 20px;
            margin: 20px;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 15px;
            font-size: 16px;
            color: var(--text-color);
            border: 2px solid var(--restricted-badge-bg);
        }

        .restricted-message i {
            font-size: 30px;
            color: var(--restricted-badge-bg);
            margin-bottom: 10px;
            display: block;
        }

        .restricted-message .subscribe-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .restricted-message .subscribe-button:hover {
            background-color: #4a49c0;
            transform: translateY(-2px);
        }

        /* Premium Access Required Modal */
        .premium-required-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .premium-required-modal.active {
            display: flex;
        }

        .premium-required-content {
            background-color: var(--bg-color);
            border-radius: 15px;
            padding: 25px;
            width: 100%;
            max-width: 350px;
            text-align: center;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .premium-required-icon {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .premium-required-title {
            font-size: 22px;
            font-weight: bold;
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .premium-required-text {
            font-size: 16px;
            color: var(--inactive-text);
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .premium-required-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .premium-required-subscribe {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .premium-required-subscribe:hover {
            background-color: #4a49c0;
            transform: translateY(-1px);
        }

        .premium-required-close {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .premium-required-close:hover {
            background-color: var(--border-color);
        }
        
        .profile-edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .profile-edit-dialog.active {
            display: flex;
        }
        
        .profile-image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .profile-image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }
        
        .profile-image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-image-preview i {
            font-size: 50px;
            color: var(--primary-color);
        }
        
        .profile-upload-btn {
            position: absolute;
            bottom: 10px;
            right: calc(50% - 60px);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        
        .profile-upload-btn:hover, .profile-upload-btn:active {
            transform: scale(1.1);
            background-color: #4a49c0;
        }

        input[type="file"] {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            text-decoration: none;
            border-bottom: none;
            padding: 0 16px; 
            margin: 15px 0;
        }
        
        .field-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .save-field-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .save-field-btn:hover {
            background-color: #4a49c0;
        }
        
        .save-field-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }
        
        .editable-field {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editable-field-input {
            flex: 1;
        }
        
        .forecasts-section {
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .ai-forecasts-section {
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .forecasts-tabs, .ai-forecasts-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin: 0;
            background-color: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 5;
            flex-shrink: 0;
        }
        
        .forecast-tab, .ai-forecast-tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
        }
        
        .forecast-tab.active, .ai-forecast-tab.active {
            color: var(--primary-color);
        }
        
        .forecast-tab.active::after, .ai-forecast-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20%;
            width: 60%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        .forecasts-content, .ai-forecasts-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }
        
        .forecasts-content.active, .ai-forecasts-content.active {
            display: flex;
            flex-direction: column;
        }
        
        .forecasts-list, .ai-forecasts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            min-height: 100%;
        }
        
        /* Amélioration du système de cartes avec 4 faces */
        .forecast-item {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            min-height: 350px;
            perspective: 1000px;
            cursor: pointer;
        }

        .forecast-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .forecast-card-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 350px;
            transform-style: preserve-3d;
        }

        .forecast-card-container.show-details {
            transform: rotateY(90deg);
        }

        .forecast-card-container.show-probabilities {
            transform: rotateY(180deg);
        }

        .forecast-card-container.show-scores {
            transform: rotateY(270deg);
        }

        .forecast-face {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: 350px;
            backface-visibility: hidden;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-radius: 15px;
            background-color: var(--card-bg);
        }

        .forecast-front {
            transform: rotateY(0deg);
        }

        .forecast-details {
            transform: rotateY(-90deg);
            background-color: var(--card-bg);
        }

        .forecast-probabilities {
            transform: rotateY(-180deg);
            background-color: var(--card-bg);
        }

        .forecast-scores {
            transform: rotateY(-270deg);
            background-color: var(--card-bg);
        }

        .face-indicator {
            position: absolute;
            bottom: 10px;
            right: 15px;
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .face-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.3);
            transition: background-color 0.3s ease;
        }

        .face-dot.active {
            background-color: var(--card-accent);
        }

        .swipe-instruction {
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 12px;
            color: var(--inactive-text);
            opacity: 0.7;
        }
        
        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .forecast-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .forecast-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .forecast-team-logo {
            width: 45px;
            height: 45px;
            background-color: var(--bg-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .forecast-team-name {
            font-weight: 500;
            text-align: center;
            font-size: 14px;
            line-height: 1.2;
        }
        
        .forecast-vs {
            font-size: 24px;
            font-weight: bold;
            padding: 0 20px;
            display: flex;
            align-items: center;
            color: var(--card-accent);
        }
        
        .forecast-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .forecast-status.pending {
            background-color: var(--forecast-pending-bg);
            color: var(--text-color);
        }
        
        .forecast-status.win {
            background-color: var(--forecast-win-bg);
            color: var(--text-color);
        }
        
        .forecast-status.loss {
            background-color: var(--forecast-loss-bg);
            color: var(--text-color);
        }
        
        .forecast-date {
            font-size: 12px;
            color: var(--inactive-text);
            margin-top: 10px;
        }
        
        .forecast-confidence {
            display: flex;
            align-items: center;
            margin-top: 15px;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .confidence-bar-container {
            flex: 1;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .confidence-bar {
            height: 100%;
            background-color: var(--card-accent);
            border-radius: 4px;
        }

        .forecast-description {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .poisson-probabilities {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .poisson-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 16px;
            color: var(--card-accent);
            text-align: center;
        }

        .poisson-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            padding: 5px 0;
        }

        .poisson-row:not(:last-child) {
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .estimated-odds {
            background-color: var(--card-accent);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        .combined-matches {
            background-color: rgba(0,0,0,0.05);
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            max-height: 180px;
            overflow-y: auto;
        }

        .combined-matches-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--card-accent);
            font-size: 14px;
        }

        .match-detail {
            background-color: var(--bg-color);
            padding: 8px;
            margin: 6px 0;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .match-name {
            font-weight: 500;
            margin-bottom: 3px;
            font-size: 13px;
        }

        .match-prediction {
            font-size: 12px;
            color: var(--card-accent);
            margin-bottom: 2px;
        }

        .match-confidence {
            font-size: 11px;
            opacity: 0.8;
        }

        /* Section des scores exacts */
        .exact-scores-section {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .exact-scores-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 16px;
            color: var(--card-accent);
            text-align: center;
        }

        .exact-score-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 6px 0;
            background-color: var(--bg-color);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .exact-score-match {
            font-weight: 500;
            font-size: 14px;
            color: var(--text-color);
        }

        .exact-score-probability {
            font-weight: bold;
            font-size: 13px;
            color: var(--card-accent);
            background-color: rgba(var(--card-accent), 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .no-forecasts {
            text-align: center;
            padding: 40px 20px;
            color: var(--inactive-text);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .no-forecasts i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--card-accent);
            opacity: 0.5;
        }

        .admin-notification {
            background-color: var(--bg-color);
            border-radius: 15px;
            margin: 10px 15px 20px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .admin-notification-header {
            color: var(--text-color);
            padding: 0 0 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            margin-bottom: 10px;
        }
        
        .admin-notification-title {
            display: flex;
            align-items: center;
        }
        
        .admin-notification-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .admin-notification-content {
            padding: 5px 0;
            line-height: 1.4;
        }
        
        .admin-notification-footer {
            padding: 5px 0 0;
            font-size: 12px;
            color: var(--inactive-text);
            text-align: right;
            border-top: none;
            margin-top: 10px;
            padding-top: 8px;
        }
        
        .event-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .event-close-btn:hover, .event-close-btn:active {
            transform: scale(1.1);
        }
        
        .event-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 5px;
        }
        
        .event-action-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: transform 0.1s ease;
        }
        
        .event-action-btn:hover, .event-action-btn:active {
            transform: translateY(-1px);
        }
        
        .event-action-btn.delete {
            color: var(--danger-color);
        }
        
        .admin-notif-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .admin-notif-dialog.active {
            display: flex;
        }
        
        .score-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .score-option {
            padding: 5px 12px;
            border-radius: 15px;
            background-color: var(--bg-color);
            font-weight: bold;
            font-size: 14px;
            border: 1px solid var(--border-color);
            transition: transform 0.1s ease;
            cursor: pointer;
        }
        
        .score-option:hover, .score-option:active {
            transform: translateY(-1px);
        }

        .score-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        #delete-account-confirmation .confirmation-text {
            color: var(--danger-color);
            font-weight: bold;
        }

        .social-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 0 15px;
            gap: 15px;
        }
        
        .social-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 10px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-decoration: none;
        }
        
        .social-button:active {
            transform: scale(0.98);
        }
        
        .social-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .social-button.whatsapp {
            background-color: var(--social-whatsapp);
        }
        
        .social-button.telegram {
            background-color: var(--social-telegram);
        }
        
        .social-button.youtube {
            background-color: var(--social-youtube);
        }

        .social-button .social-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .about-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .about-dialog.active {
            display: flex;
        }
        
        .about-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .about-logo {
            text-align: center;
            margin: 20px 0;
        }
        
        .about-logo i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .about-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .about-version {
            text-align: center;
            font-size: 14px;
            color: var(--inactive-text);
            margin-bottom: 30px;
        }
        
        .about-section {
            margin-bottom: 25px;
        }
        
        .about-section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .about-section-content {
            line-height: 1.5;
            font-size: 14px;
        }
        
        .about-footer {
            text-align: center;
            padding: 20px 0;
            font-size: 12px;
            color: var(--inactive-text);
            border-top: none;
            margin-top: auto;
        }

        .edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .edit-dialog.active {
            display: flex;
        }
        
        .edit-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
            flex-shrink: 0;
        }
        
        .edit-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .edit-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .edit-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .terms-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .terms-dialog.active {
            display: flex;
        }
        
        .terms-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .terms-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
            flex-shrink: 0;
        }
        
        .terms-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .terms-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .warning-box {
            background-color: var(--warning-bg);
            border-left: 4px solid var(--warning-text);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .warning-box i {
            color: var(--warning-text);
            margin-right: 10px;
        }
    
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .search-button, .events-button, .info-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-button:active, .events-button:active, .info-button:active {
            background-color: var(--secondary-color);
        }
        
        /* Improved search bar animation */
        @keyframes searchBarIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes searchBarOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-5px);
            }
        }
        
        .search-container.active {
            animation: searchBarIn 0.3s ease forwards;
        }
        
        .search-container.hiding {
            animation: searchBarOut 0.3s ease forwards;
        }
        
        /* Touch ripple effect for buttons */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        
        /* Interface Theme Selector Enhanced */
        .interface-sections {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .interface-section {
            background: linear-gradient(135deg, var(--secondary-color), rgba(93, 92, 222, 0.05));
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(93, 92, 222, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .interface-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        .interface-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .interface-title i {
            font-size: 20px;
        }

        .interface-subtitle {
            font-size: 13px;
            color: var(--inactive-text);
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 15px 0;
        }
        
        .theme-option {
            width: 100%;
            height: 70px;
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            border: 2px solid var(--theme-selector-border);
            overflow: hidden;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .theme-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .theme-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-color), 0.3);
            transform: scale(1.1);
        }
        
        .theme-option.active:before {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-shadow: 0 0 5px rgba(0,0,0,0.7);
            z-index: 3;
        }
        
        .theme-option.theme-blue {
            background: linear-gradient(135deg, #5D5CDE, #4a49c0);
        }
        
        .theme-option.theme-green {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
        }
        
        .theme-option.theme-red {
            background: linear-gradient(135deg, #F44336, #d32f2f);
        }
        
        .theme-option.theme-orange {
            background: linear-gradient(135deg, #FF9800, #f57c00);
        }

        .theme-option.theme-red-pink {
            background: linear-gradient(135deg, #F44336, #E91E63);
        }

        .theme-option.theme-green-yellow {
            background: linear-gradient(135deg, #4CAF50, #CDDC39);
        }

        .theme-option.theme-blue-purple {
            background: linear-gradient(135deg, #2196F3, #9C27B0);
        }

        .theme-option.theme-orange-gold {
            background: linear-gradient(135deg, #FF9800, #FFC107);
        }

        .theme-option.theme-purple {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
        }

        .theme-option.theme-teal {
            background: linear-gradient(135deg, #009688, #00695C);
        }

        .theme-option.theme-indigo {
            background: linear-gradient(135deg, #3F51B5, #303F9F);
        }

        .theme-option.theme-pink {
            background: linear-gradient(135deg, #E91E63, #C2185B);
        }

        .theme-option.theme-cyan {
            background: linear-gradient(135deg, #00BCD4, #0097A7);
        }

        .theme-option.theme-lime {
            background: linear-gradient(135deg, #CDDC39, #AFB42B);
        }

        .theme-option.theme-amber {
            background: linear-gradient(135deg, #FFC107, #FF8F00);
        }

        .theme-option.theme-deep-orange {
            background: linear-gradient(135deg, #FF5722, #D84315);
        }

        .theme-option.theme-hightech {
            background: linear-gradient(135deg, #0a0a0a, #00ff88);
            border-color: #00ff88;
        }
        
        .theme-label {
            margin-top: 8px;
            font-size: 10px;
            text-align: center;
            font-weight: 600;
            line-height: 1.2;
            color: var(--text-color);
            opacity: 0.8;
        }

        .card-style-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .card-style-option {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--theme-selector-border);
            cursor: pointer;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            background-color: var(--bg-color);
        }

        .card-style-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-color), 0.05);
        }

        .card-style-option.active {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-color), 0.1);
            color: var(--primary-color);
        }

        /* Subscription Section Styles */
        .subscription-section {
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .current-plan {
            background-color: var(--plan-active-bg);
            border: 2px solid var(--plan-active-border);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            text-align: center;
        }

        .current-plan-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .current-plan-info {
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .sats-balance {
            font-size: 24px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 10px 0;
        }

        .sats-balance .bitcoin-icon {
            margin-right: 8px;
            display: inline;
            position: static;
            transform: none;
            width: auto;
            height: auto;
            border-radius: 0;
            background: none;
            box-shadow: none;
        }

        .plan-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .plan-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.2);
        }

        .plan-item.popular {
            border-color: var(--primary-color);
            position: relative;
        }

        .plan-item.popular::before {
            content: "Populaire";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .plan-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-price .bitcoin-icon {
            display: inline;
            position: static;
            transform: none;
            width: auto;
            height: auto;
            border-radius: 0;
            background: none;
            box-shadow: none;
        }

        .plan-duration {
            font-size: 14px;
            color: var(--inactive-text);
        }

        .plan-features {
            list-style: none;
            margin: 15px 0;
            text-align: left;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .plan-features li::before {
            content: '✓';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 10px;
        }

        .plan-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s ease;
        }

        .plan-button:hover {
            background-color: #4a49c0;
            transform: translateY(-2px);
        }

        .plan-button:active {
            transform: translateY(0);
        }

        .plan-button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
            transform: none;
        }

        /* Lightning Payment Modal */
        .lightning-payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .lightning-payment-modal.active {
            display: flex;
        }

        .lightning-payment-content {
            background-color: var(--bg-color);
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .lightning-payment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .lightning-payment-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
        }

        .lightning-payment-close {
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .lightning-payment-close:hover {
            background-color: var(--secondary-color);
        }

        .payment-amount {
            text-align: center;
            margin-bottom: 20px;
        }

        .payment-amount-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--sats-color);
            margin-bottom: 5px;
        }

        .payment-amount-label {
            color: var(--inactive-text);
            font-size: 14px;
        }

        .invoice-container {
            margin-bottom: 20px;
        }

        .invoice-label {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .invoice-text {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            max-height: 100px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .copy-invoice-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.2s ease;
        }

        .copy-invoice-btn:hover {
            background-color: #4a49c0;
        }

        .payment-status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .payment-status.pending {
            background-color: var(--forecast-pending-bg);
            color: var(--text-color);
        }

        .payment-status.success {
            background-color: var(--forecast-win-bg);
            color: var(--success-color);
        }

        .payment-status.error {
            background-color: var(--forecast-loss-bg);
            color: var(--danger-color);
        }

        .payment-warning {
            background-color: var(--warning-bg);
            border: 2px solid var(--warning-text);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            color: var(--warning-text);
        }

        .payment-warning i {
            font-size: 20px;
            margin-bottom: 10px;
            display: block;
        }

        .cancel-payment-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background-color 0.2s ease;
        }

        .cancel-payment-btn:hover {
            background-color: #d32f2f;
        }

        /* Tutorials Section Styles */
        .tutorials-section {
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .tutorial-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            margin: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .tutorial-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tutorial-thumbnail {
            position: relative;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color), #4a49c0);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .tutorial-play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .tutorial-thumbnail:hover .tutorial-play-button {
            transform: scale(1.1);
            background-color: white;
        }

        .tutorial-content {
            padding: 20px;
        }

        .tutorial-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .tutorial-description {
            color: var(--inactive-text);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .tutorial-duration {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
        }

        .tutorial-duration i {
            margin-right: 8px;
        }

        .tutorial-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--sats-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .video-modal.active {
            display: flex;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: auto;
            max-height: 80vh;
        }

        .video-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: background-color 0.2s ease;
        }

        .video-close:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        /* History Section Styles */
        .history-section {
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .history-date-header {
            background-color: var(--history-date-bg);
            color: var(--history-date-text);
            padding: 12px 20px;
            margin: 0 15px 15px;
            border-radius: 10px;
            font-weight: bold;
            text-align: center;
            font-size: 16px;
        }

        .history-category-section {
            margin-bottom: 25px;
        }

        .history-category-title {
            background-color: var(--secondary-color);
            padding: 10px 20px;
            margin: 0 15px 10px;
            border-radius: 8px;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 14px;
            text-transform: uppercase;
        }

        .history-forecasts-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 0 15px;
        }

        .history-forecast-item {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid var(--primary-color);
            opacity: 0.9;
            transform: scale(0.98);
        }

        .history-forecast-item .forecast-status.win {
            background-color: var(--forecast-win-bg);
            color: var(--success-color);
        }

        .history-forecast-item .forecast-status.loss {
            background-color: var(--forecast-loss-bg);
            color: var(--danger-color);
        }

        .history-forecast-item .forecast-status.pending {
            background-color: var(--forecast-pending-bg);
            color: var(--text-color);
        }

        /* Note d'abonnement gratuit */
        .free-subscription-note {
            background: linear-gradient(135deg, var(--success-color), #66bb6a);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .free-subscription-note h3 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .free-subscription-note p {
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
            opacity: 0.95;
        }

        /* Corriger les boutons flottants - renommer la classe .fab en .floating-action-button */
        .floating-action-button {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 20px;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .floating-action-button:hover {
            transform: scale(1.1);
        }

        .floating-action-button:active {
            transform: scale(0.95);
        }
        
        @media (max-height: 640px) {
            .floating-action-button {
                bottom: 70px;
            }
        }
        
        @media (max-width: 380px) {
            .confirmation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .confirmation-button {
                width: 100%;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <div id="verify-animation" class="verify-animation">
        <div class="football-bounce">
            <i class="fas fa-futbol"></i>
        </div>
        <div class="verify-text">Vérification en cours...</div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-log-panel" class="debug-log-panel">
        <div class="debug-log-header">
            <span>Debug Console</span>
            <span class="debug-log-close" id="debug-log-close">×</span>
        </div>
        <div class="debug-log-content" id="debug-log-content">
            <!-- Logs will be added here -->
        </div>
    </div>

    <div id="debug-toggle-btn" class="debug-toggle-btn">
        <i class="fas fa-bug"></i>
    </div>

    <!-- Premium Access Required Modal -->
    <div id="premium-required-modal" class="premium-required-modal">
        <div class="premium-required-content">
            <div class="premium-required-icon">
                <i class="fas fa-crown"></i>
            </div>
            <div class="premium-required-title">Accès Premium Requis</div>
            <div class="premium-required-text">
                Accédez aux prédictions IA avancées, combinés intelligents et analyses premium avec un abonnement !
            </div>
            <div class="premium-required-buttons">
                <button class="premium-required-subscribe" id="premium-modal-subscribe">
                    S'abonner maintenant
                </button>
                <button class="premium-required-close" id="premium-modal-close">
                    Fermer
                </button>
            </div>
        </div>
    </div>

    <!-- Lightning Payment Modal -->
    <div id="lightning-payment-modal" class="lightning-payment-modal">
        <div class="lightning-payment-content">
            <div class="lightning-payment-header">
                <div class="lightning-payment-title">Paiement Lightning ⚡</div>
                <div class="lightning-payment-close" id="lightning-payment-close">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            
            <div class="payment-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>IMPORTANT :</strong> Ne fermez pas cette fenêtre pendant le paiement !
                Le processus peut prendre quelques minutes.
            </div>
            
            <div class="payment-amount">
                <div class="payment-amount-value" id="payment-amount-value">10 sats</div>
                <div class="payment-amount-label">Plan Quotidien</div>
            </div>
            
            <div class="invoice-container">
                <div class="invoice-label">Invoice Lightning :</div>
                <div class="invoice-text" id="lightning-invoice-text"></div>
                <button class="copy-invoice-btn" id="copy-lightning-invoice">Copier Invoice</button>
            </div>
            
            <div class="payment-status pending" id="lightning-payment-status">
                ⏳ En attente de paiement...
            </div>
            
            <button class="cancel-payment-btn" id="cancel-lightning-payment">
                Annuler le paiement
            </button>
        </div>
    </div>
    
    <div class="side-menu" id="side-menu">
        <div class="side-menu-header">
            <div class="side-menu-close" id="side-menu-close">
                <i class="fas fa-times"></i>
            </div>
            <div class="side-menu-title">Pari Alliance</div>
        </div>
        <div class="side-menu-content">
            <div class="side-menu-item" id="menu-history">
                <i class="fas fa-history"></i>
                <div class="side-menu-text">Historique</div>
            </div>
            <div class="side-menu-item" id="menu-subscription">
                <i class="fas fa-crown"></i>
                <div class="side-menu-text">Abonnement</div>
            </div>
            <div class="side-menu-item" id="menu-tutorials">
                <i class="fas fa-play-circle"></i>
                <div class="side-menu-text">Tutoriels</div>
            </div>
            <div class="side-menu-item" id="menu-interface">
                <i class="fas fa-paint-brush"></i>
                <div class="side-menu-text">Interface</div>
            </div>
        </div>
        <div class="side-menu-footer">
            <div class="side-menu-item" id="menu-terms">
                <i class="fas fa-file-alt"></i>
                <div class="side-menu-text">Conditions d'utilisation</div>
            </div>
            <div class="side-menu-item" id="menu-about">
                <i class="fas fa-info-circle"></i>
                <div class="side-menu-text">À propos</div>
            </div>
        </div>
    </div>
    
    <div class="side-menu-overlay" id="side-menu-overlay"></div>
    
    <div id="auth-screen" class="auth-screen" style="display: none;">
        <div class="auth-header">
            <div class="auth-logo">
                <i class="fas fa-futbol"></i>
            </div>
            <h1 class="auth-title">Pari Alliance</h1>
            <p class="auth-subtitle">Pronostics sportifs avancés</p>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" id="login-tab">Connexion</div>
            <div class="auth-tab" id="register-tab">Inscription</div>
        </div>
        
        <div id="login-form" class="auth-form active">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="Votre email">
                <div id="login-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="login-password" placeholder="Votre mot de passe">
                <div id="login-password-error" class="form-error">Le mot de passe est obligatoire</div>
            </div>
            
            <div id="login-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="loginBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Se connecter</span>
                </button>
                <p class="form-footer-text">
                    Vous n'avez pas de compte ? <a href="#" class="form-link" id="goto-register">S'inscrire</a>
                </p>
            </div>
        </div>
        
        <div id="register-form" class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="register-email" placeholder="Votre adresse email">
                <div id="register-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="register-password" placeholder="Créez un mot de passe sécurisé">
                <div id="register-password-error" class="form-error">Le mot de passe doit contenir au moins 6 caractères</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirmer le mot de passe</label>
                <input type="password" class="form-input" id="register-confirm-password" placeholder="Confirmez votre mot de passe">
                <div id="register-confirm-password-error" class="form-error">Les mots de passe ne correspondent pas</div>
            </div>
            
            <div id="register-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="registerBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">S'inscrire</span>
                </button>
                <p class="form-footer-text">
                    Vous avez déjà un compte ? <a href="#" class="form-link" id="goto-login">Se connecter</a>
                </p>
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <i class="fas fa-futbol loading-spinner"></i>
        <div style="font-weight: bold; font-size: 24px; color: var(--primary-color);">Pari Alliance</div>
        <div style="margin-top: 10px; color: #6b7280;">Chargement...</div>
    </div>

    <div class="header">
        <div class="header-left">
            <div id="header-menu-button" class="menu-button">
                <i class="fas fa-bars"></i>
            </div>
            <div id="header-back-button" class="back-button" style="display:none;">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
        <div id="header-title" class="header-title">Simples</div>
        <div id="header-action">
            <div class="search-button" id="search-button">
                <i class="fas fa-search"></i>
            </div>
            <div class="events-button" id="events-button">
                <i class="fas fa-bell"></i>
                <div class="notification-dot" id="events-notification-dot"></div>
            </div>
        </div>
        
        <div class="search-container" id="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Rechercher...">
            <div class="search-close" id="search-close">
                <i class="fas fa-times"></i>
            </div>
        </div>
    </div>

    <div class="content">
        <!-- Section des pronostics simples maintenant par défaut -->
        <div id="forecasts-section" class="section active">
            <div class="forecasts-content active" style="height: 100%; overflow-y: auto;">
                <div class="forecasts-list" id="simple-forecasts-list">
                </div>
            </div>
        </div>

        <!-- Section Prédictions IA pour abonnés seulement -->
        <div id="ai-forecasts-section" class="section">
            <div class="ai-forecasts-tabs">
                <div class="ai-forecast-tab active" data-tab="combines">Combinés</div>
                <div class="ai-forecast-tab" data-tab="ia-singles">Singles Premium</div>
                <div class="ai-forecast-tab" data-tab="safes">Safes</div>
            </div>
            
            <div class="ai-forecasts-content active" id="combines-content">
                <div class="ai-forecasts-list" id="combines-list">
                </div>
            </div>
            
            <div class="ai-forecasts-content" id="ia-singles-content">
                <div class="ai-forecasts-list" id="ia-singles-list">
                </div>
            </div>

            <div class="ai-forecasts-content" id="safes-content">
                <div class="ai-forecasts-list" id="safes-list">
                </div>
            </div>
        </div>

        <!-- Nouvelle Section Historique -->
        <div id="history-section" class="section">
            <div style="height: 100%; overflow-y: auto; padding: 10px 0;">
                <div id="history-content">
                    <!-- L'historique sera chargé ici -->
                </div>
            </div>
        </div>
        
        <div id="events-section" class="section">
            <div id="events-list" style="height: 100%; overflow-y: auto; padding: 10px;">
                <div class="empty-state">
                    <i class="fas fa-bell"></i>
                    <div class="empty-state-title">Aucun événement</div>
                    <div class="empty-state-text">Les événements apparaîtront ici</div>
                </div>
            </div>
        </div>
        
        <div id="subscription-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="current-plan">
                    <div class="current-plan-title">Plan Actuel</div>
                    <div class="current-plan-info" id="current-plan-name">Plan Gratuit</div>
                    <div class="sats-balance">
                        <i class="fab fa-bitcoin bitcoin-icon"></i>
                        <span id="user-sats-balance">0</span> sats
                    </div>
                    <div style="font-size: 14px; color: var(--inactive-text);" id="plan-expiry-info">
                        Rechargez vos sats pour accéder aux plans premium
                    </div>
                </div>

                <div class="plan-item popular">
                    <div class="plan-title">
                        <i class="fas fa-calendar-day"></i>
                        Plan Quotidien
                    </div>
                    <div class="plan-price">
                        <i class="fab fa-bitcoin bitcoin-icon"></i>
                        10 <span class="plan-duration">sats/jour</span>
                    </div>
                    <ul class="plan-features">
                        <li>Accès aux prédictions IA du jour</li>
                        <li>Combinés intelligents</li>
                        <li>Singles Premium exclusifs</li>
                        <li>Analyses safes avancées</li>
                        <li>Badge Premium</li>
                        <li>Support prioritaire</li>
                    </ul>
                    <button class="plan-button" id="daily-plan-btn">
                        S'abonner au plan quotidien
                    </button>
                </div>

                <div class="plan-item">
                    <div class="plan-title">
                        <i class="fas fa-calendar-week"></i>
                        Plan Hebdomadaire
                    </div>
                    <div class="plan-price">
                        <i class="fab fa-bitcoin bitcoin-icon"></i>
                        60 <span class="plan-duration">sats/semaine</span>
                    </div>
                    <ul class="plan-features">
                        <li>Tous les avantages du plan quotidien</li>
                        <li>Économisez 10 sats par semaine</li>
                        <li>Accès aux analyses avancées</li>
                        <li>Historique complet des pronostics</li>
                        <li>Badge Premium permanent</li>
                        <li>Accès prioritaire aux nouveautés</li>
                    </ul>
                    <button class="plan-button" id="weekly-plan-btn">
                        S'abonner au plan hebdomadaire
                    </button>
                </div>
            </div>
        </div>

        <div id="tutorials-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="tutorial-item">
                    <div class="tutorial-thumbnail" data-video="free-sats">
                        <div class="tutorial-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="tutorial-badge">Gratuit</div>
                    </div>
                    <div class="tutorial-content">
                        <div class="tutorial-title">Comment obtenir des sats gratuitement</div>
                        <div class="tutorial-description">
                            Découvrez toutes les méthodes pour gagner des satoshis gratuitement et recharger votre compte sans dépenser d'argent. Ce tutoriel vous guide à travers différentes plateformes et techniques pour accumuler des sats.
                        </div>
                        <div class="tutorial-duration">
                            <i class="far fa-clock"></i>
                            5 minutes
                        </div>
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-thumbnail" data-video="buy-plan">
                        <div class="tutorial-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="tutorial-badge">Premium</div>
                    </div>
                    <div class="tutorial-content">
                        <div class="tutorial-title">Comment acheter un plan d'abonnement</div>
                        <div class="tutorial-description">
                            Guide complet pour souscrire à un plan premium et profiter de tous les avantages de Pari Alliance. Apprenez à gérer votre abonnement et optimiser votre utilisation de la plateforme.
                        </div>
                        <div class="tutorial-duration">
                            <i class="far fa-clock"></i>
                            3 minutes
                        </div>
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-thumbnail" data-video="understand-predictions">
                        <div class="tutorial-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="tutorial-badge">Éducatif</div>
                    </div>
                    <div class="tutorial-content">
                        <div class="tutorial-title">Comment comprendre nos prédictions</div>
                        <div class="tutorial-description">
                            Apprenez à interpréter nos analyses IA, comprendre les probabilités et optimiser vos choix de paris. Un guide essentiel pour maximiser vos gains avec nos pronostics.
                        </div>
                        <div class="tutorial-duration">
                            <i class="far fa-clock"></i>
                            7 minutes
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="interface-section" class="section">
            <div style="height: 100%; overflow-y: auto; padding: 10px;">
                <div class="interface-sections">
                    <div class="interface-section">
                        <div class="interface-title">
                            <i class="fas fa-palette"></i>
                            Thème de couleur
                        </div>
                        <div class="interface-subtitle">
                            Personnalisez l'apparence de l'application avec une large gamme de couleurs et modes
                        </div>
                        <div class="theme-selector">
                            <div class="theme-option theme-blue active" data-theme="default">
                                <div class="theme-label">Bleu</div>
                            </div>
                            <div class="theme-option theme-green" data-theme="green">
                                <div class="theme-label">Vert</div>
                            </div>
                            <div class="theme-option theme-red" data-theme="red">
                                <div class="theme-label">Rouge</div>
                            </div>
                            <div class="theme-option theme-orange" data-theme="orange">
                                <div class="theme-label">Orange</div>
                            </div>
                            <div class="theme-option theme-red-pink" data-theme="red-pink">
                                <div class="theme-label">Rouge-Rose</div>
                            </div>
                            <div class="theme-option theme-green-yellow" data-theme="green-yellow">
                                <div class="theme-label">Vert-Jaune</div>
                            </div>
                            <div class="theme-option theme-blue-purple" data-theme="blue-purple">
                                <div class="theme-label">Bleu-Violet</div>
                            </div>
                            <div class="theme-option theme-orange-gold" data-theme="orange-gold">
                                <div class="theme-label">Orange-Doré</div>
                            </div>
                            <div class="theme-option theme-purple" data-theme="purple">
                                <div class="theme-label">Violet</div>
                            </div>
                            <div class="theme-option theme-teal" data-theme="teal">
                                <div class="theme-label">Turquoise</div>
                            </div>
                            <div class="theme-option theme-indigo" data-theme="indigo">
                                <div class="theme-label">Indigo</div>
                            </div>
                            <div class="theme-option theme-pink" data-theme="pink">
                                <div class="theme-label">Rose</div>
                            </div>
                            <div class="theme-option theme-cyan" data-theme="cyan">
                                <div class="theme-label">Cyan</div>
                            </div>
                            <div class="theme-option theme-lime" data-theme="lime">
                                <div class="theme-label">Lime</div>
                            </div>
                            <div class="theme-option theme-amber" data-theme="amber">
                                <div class="theme-label">Ambre</div>
                            </div>
                            <div class="theme-option theme-deep-orange" data-theme="deep-orange">
                                <div class="theme-label">Orange Foncé</div>
                            </div>
                            <div class="theme-option theme-hightech" data-theme="hightech">
                                <div class="theme-label">High-Tech</div>
                            </div>
                        </div>
                    </div>

                    <div class="interface-section">
                        <div class="interface-title">
                            <i class="fas fa-brush"></i>
                            Style des cartes
                        </div>
                        <div class="interface-subtitle">
                            Personnalisez l'apparence des cartes de pronostics avec différents effets visuels
                        </div>
                        <div class="card-style-selector">
                            <div class="card-style-option active" data-style="default">
                                Standard
                            </div>
                            <div class="card-style-option" data-style="gradient">
                                Dégradé
                            </div>
                            <div class="card-style-option" data-style="glass">
                                Verre
                            </div>
                            <div class="card-style-option" data-style="shadow">
                                Ombre
                            </div>
                            <div class="card-style-option" data-style="neon">
                                Néon
                            </div>
                        </div>
                    </div>
                    
                    <div class="interface-section">
                        <div class="interface-title">
                            <i class="fas fa-moon"></i>
                            Mode d'affichage
                        </div>
                        <div class="interface-subtitle">
                            Choisissez entre le mode clair, sombre ou high-tech selon vos préférences
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-row">
                                <div class="setting-icon">
                                    <i class="fas fa-sun" style="color: var(--primary-color);"></i>
                                </div>
                                <div class="setting-label">Mode clair</div>
                            </div>
                            <label class="switch">
                                <input type="radio" name="display-mode" id="light-mode" value="light">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-row">
                                <div class="setting-icon">
                                    <i class="fas fa-moon" style="color: var(--primary-color);"></i>
                                </div>
                                <div class="setting-label">Mode sombre</div>
                            </div>
                            <label class="switch">
                                <input type="radio" name="display-mode" id="dark-mode" value="dark">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-row">
                                <div class="setting-icon">
                                    <i class="fas fa-microchip" style="color: var(--primary-color);"></i>
                                </div>
                                <div class="setting-label">Mode High-Tech</div>
                            </div>
                            <label class="switch">
                                <input type="radio" name="display-mode" id="hightech-mode" value="hightech">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="profile-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="profile-header">
                    <div class="profile-pic">
                        <i class="fas fa-user"></i>
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">
                            <span id="profile-name-text">Utilisateur</span>
                            <span class="admin-badge" id="admin-badge" style="display: none;">Admin</span>
                            <span class="premium-badge" id="premium-badge" style="display: none;">Premium</span>
                        </div>
                        <div class="profile-email" id="profile-email">user@example.com</div>
                        <div class="profile-status">En ligne</div>
                        <div class="profile-edit" id="edit-profile-btn">
                            <i class="fas fa-edit"></i> Modifier le profil
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Paramètres</div>

                <!-- Note d'abonnement gratuit -->
                <div class="free-subscription-note">
                    <h3>
                        <i class="fas fa-gift"></i>
                        Abonnement Gratuit !
                    </h3>
                    <p>
                        🎉 Abonnez-vous à nos trois réseaux sociaux (WhatsApp, Telegram et YouTube) et recevez un abonnement premium gratuit !
                    </p>
                    <button class="button claim" id="claim-free-subscription">
                        <i class="fab fa-whatsapp"></i>
                        Réclamer mon abonnement gratuit
                    </button>
                </div>
                
                <div class="settings-container">
                    <div class="section-title">Nous rejoindre</div>
                    
                    <div class="social-buttons">
                        <a href="https://whatsapp.com/channel/0029Vb6eoNkATRSqdUT76Y3Y" target="_blank" rel="noopener noreferrer" class="social-button whatsapp">
                            <i class="fab fa-whatsapp social-icon"></i>
                            WhatsApp
                        </a>
                        <a href="https://t.me/parialliance" target="_blank" rel="noopener noreferrer" class="social-button telegram">
                            <i class="fab fa-telegram social-icon"></i>
                            Telegram
                        </a>
                        <a href="https://youtube.com/@parialliance?si=MMQ8MwI-XZNK7SiG" target="_blank" rel="noopener noreferrer" class="social-button youtube">
                            <i class="fab fa-youtube social-icon"></i>
                            YouTube
                        </a>
                    </div>
                    
                    <button id="logout-btn" class="button">Se déconnecter</button>
                    <button id="delete-account-btn" class="button danger" style="margin-top: 15px;">Supprimer mon compte</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="admin-notif-dialog" class="admin-notif-dialog">
        <div class="edit-header">
            <div class="edit-back" id="admin-notif-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Nouvelle notification</div>
        </div>
        <div class="edit-content">
            <div class="form-group">
                <label class="form-label">Titre de la notification</label>
                <input type="text" class="form-input" id="notif-title" placeholder="Titre de votre notification">
                <div id="notif-title-error" class="field-error">Le titre est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contenu</label>
                <textarea class="form-input" id="notif-content" placeholder="Contenu de votre notification" rows="5" style="resize: none;"></textarea>
                <div id="notif-content-error" class="field-error">Le contenu est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Type de notification</label>
                <select class="form-input" id="notif-type">
                    <option value="info">Information</option>
                    <option value="alert">Alerte</option>
                    <option value="update">Mise à jour</option>
                </select>
            </div>
            
            <button class="button" id="send-notification-btn">
                <span class="btn-loader" style="display:none;"></span>
                <span class="btn-text">Envoyer la notification</span>
            </button>
        </div>
    </div>
    
    <div id="profile-edit-dialog" class="profile-edit-dialog">
        <div class="edit-header">
            <div class="edit-back" id="profile-edit-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Modifier le profil</div>
        </div>
        <div class="edit-content">
            <div class="profile-image-upload">
                <div class="profile-image-preview" id="profile-image-preview">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-upload-btn" id="profile-upload-btn">
                    <i class="fas fa-camera"></i>
                </div>
                <input type="file" id="profile-image-input" accept="image/*">
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom d'utilisateur</label>
                <div class="editable-field">
                    <input type="text" class="form-input editable-field-input" id="edit-display-name" placeholder="Entrez votre nom d'utilisateur">
                    <button class="save-field-btn" id="save-display-name-btn">Enregistrer</button>
                </div>
                <div id="edit-display-name-error" class="field-error">Le nom d'utilisateur est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Photo de profil</label>
                <button class="button" id="save-profile-image-btn" style="margin-top: 10px;">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Enregistrer la photo</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="about-dialog" class="about-dialog">
        <div class="edit-header">
            <div class="edit-back" id="about-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">À propos</div>
        </div>
        <div class="about-content">
            <div class="about-logo">
                <i class="fas fa-futbol"></i>
                <div class="about-title">Pari Alliance</div>
                <div class="about-version">Version 2.0.0</div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Description</div>
                <div class="about-section-content">
                    Pari Alliance est une application de prédictions sportives révolutionnaire qui combine l'intelligence artificielle avancée avec des analyses de données en temps réel pour fournir des pronostics précis et fiables dans le domaine sportif.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Fonctionnalités</div>
                <div class="about-section-content">
                    <strong>Plan Gratuit :</strong><br>
                    • Pronostics simples quotidiens<br>
                    • Accès aux événements et notifications<br>
                    • Personnalisation de l'interface<br>
                    • Historique des 2 derniers jours<br><br>
                    
                    <strong>Plans Premium :</strong><br>
                    • Prédictions IA avancées<br>
                    • Combinés intelligents optimisés<br>
                    • Singles Premium exclusifs<br>
                    • Analyses safes avancées<br>
                    • Badge Premium distinctif<br>
                    • Support prioritaire<br>
                    • Accès prioritaire aux nouveautés
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Système d'abonnement</div>
                <div class="about-section-content">
                    Nos abonnements fonctionnent avec des satoshis (sats), la plus petite unité du Bitcoin, permettant des micro-paiements rapides et sécurisés via le Lightning Network.<br><br>
                    
                    <strong>Plans disponibles :</strong><br>
                    • Plan Quotidien : 10 sats/jour<br>
                    • Plan Hebdomadaire : 60 sats/semaine (économie de 10 sats)<br><br>
                    
                    Les abonnements se renouvellent automatiquement à minuit (00h00) et donnent accès à toutes les fonctionnalités premium pendant la durée active.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Technologie</div>
                <div class="about-section-content">
                    Notre plateforme utilise des algorithmes d'intelligence artificielle sophistiqués pour analyser des milliers de données sportives, statistiques d'équipes, performances historiques et tendances actuelles afin de générer des prédictions avec un taux de précision optimal.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Confidentialité et sécurité</div>
                <div class="about-section-content">
                    Pari Alliance respecte strictement votre vie privée. Vos données personnelles sont protégées par des protocoles de sécurité avancés et ne sont jamais partagées avec des tiers. Tous les paiements sont sécurisés via le Lightning Network Bitcoin.
                </div>
            </div>
            
            <div class="about-footer">
                © 2025-2026 Pari Alliance - Pronosoft AI. Tous droits réservés.
            </div>
        </div>
    </div>
    
    <div id="terms-dialog" class="terms-dialog">
        <div class="terms-header">
            <div class="terms-back" id="terms-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="terms-title">Conditions d'utilisation</div>
        </div>
        <div class="terms-content">
            <div class="about-section">
                <div class="about-section-title">Conditions générales d'utilisation</div>
                <div class="about-section-content">
                    En utilisant l'application Pari Alliance, vous acceptez de respecter les présentes conditions d'utilisation. L'accès et l'utilisation de cette application sont soumis à votre acceptation et au respect des présentes conditions. Toute violation de ces termes peut entraîner la suspension ou la résiliation de votre compte.
                </div>
            </div>
            
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>AVERTISSEMENT IMPORTANT :</strong> Les pronostics fournis par Pari Alliance sont destinés uniquement à des fins d'information et de divertissement. La revente, redistribution ou commercialisation de ces pronostics est strictement interdite et passible de bannissement définitif et de poursuites judiciaires.
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Utilisation des pronostics et responsabilité</div>
                <div class="about-section-content">
                    <strong>Nature des pronostics :</strong><br>
                    Les prédictions sportives générées par notre intelligence artificielle sont basées sur des analyses statistiques et des algorithmes avancés. Cependant, le sport reste imprévisible par nature.<br><br>
                    
                    <strong>Limitation de responsabilité :</strong><br>
                    Pari Alliance ne peut être tenu responsable des pertes financières résultant de l'utilisation de nos pronostics. Des événements imprévisibles (cartons rouges, pénaltys, blessures, conditions météorologiques, décisions arbitrales, etc.) peuvent influencer l'issue des matchs indépendamment de nos analyses.<br><br>
                    
                    <strong>Recommandations d'usage :</strong><br>
                    • Utilisez nos pronostics comme aide à la décision, non comme garantie<br>
                    • Pariez toujours de manière responsable et dans vos moyens<br>
                    • Ne misez jamais plus que ce que vous pouvez vous permettre de perdre<br>
                    • Considérez le pari sportif comme un divertissement, non un investissement
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Propriété intellectuelle et interdictions</div>
                <div class="about-section-content">
                    <strong>Propriété des contenus :</strong><br>
                    Tous les pronostics, analyses et contenus générés par Pari Alliance sont la propriété exclusive de Pronosoft AI. Ils sont protégés par les droits d'auteur et la propriété intellectuelle.<br><br>
                    
                    <strong>Interdictions formelles :</strong><br>
                    • Revendre ou commercialiser nos pronostics sous quelque forme que ce soit<br>
                    • Partager ou redistribuer nos analyses premium en dehors de la plateforme<br>
                    • Copier, reproduire ou utiliser nos contenus à des fins commerciales<br>
                    • Créer des comptes multiples pour contourner les limitations<br>
                    • Utiliser des méthodes automatisées pour extraire nos données<br><br>
                    
                    <strong>Sanctions :</strong><br>
                    Toute violation de ces interdictions entraînera la suspension immédiate du compte et pourra donner lieu à des poursuites judiciaires pour violation de propriété intellectuelle.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Abonnements et paiements</div>
                <div class="about-section-content">
                    <strong>Système de paiement :</strong><br>
                    Les abonnements premium fonctionnent avec des satoshis (sats) via le Lightning Network Bitcoin, garantissant des transactions rapides et sécurisées.<br><br>
                    
                    <strong>Durée et renouvellement :</strong><br>
                    • Les abonnements expirent automatiquement à minuit (00h00)<br>
                    • Aucun renouvellement automatique n'est effectué<br>
                    • Vous devez renouveler manuellement votre abonnement<br><br>
                    
                    <strong>Politique de remboursement :</strong><br>
                    En raison de la nature numérique instantanée de nos services et des micro-paiements en cryptomonnaie, aucun remboursement n'est possible une fois l'accès premium activé.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Conduite des utilisateurs</div>
                <div class="about-section-content">
                    En utilisant Pari Alliance, vous vous engagez à :<br>
                    • Respecter les autres utilisateurs et maintenir un environnement respectueux<br>
                    • Ne pas publier de contenu illégal, diffamatoire ou offensant<br>
                    • Ne pas usurper l'identité d'autres personnes<br>
                    • Ne pas tenter de contourner les mesures de sécurité de l'application<br>
                    • Signaler tout comportement suspect ou violation des conditions
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Modifications et résiliation</div>
                <div class="about-section-content">
                    Pari Alliance se réserve le droit de modifier ces conditions d'utilisation à tout moment. Les utilisateurs seront notifiés des changements importants. Nous nous réservons également le droit de suspendre ou résilier l'accès à l'application en cas de violation de ces conditions.
                </div>
            </div>
        </div>
    </div>
    
    <div id="delete-account-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Supprimer votre compte ?</div>
        <div class="confirmation-text">ATTENTION : Cette action est définitive et irréversible. Toutes vos données seront supprimées.</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="delete-account-cancel">Annuler</div>
            <div class="confirmation-button confirmation-delete" id="delete-account-confirm">Supprimer</div>
        </div>
    </div>

    <div id="logout-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Se déconnecter ?</div>
        <div class="confirmation-text">Voulez-vous vraiment vous déconnecter de Pari Alliance ?</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="logout-cancel">Annuler</div>
            <div class="confirmation-button confirmation-confirm" id="logout-confirm">Déconnecter</div>
        </div>
    </div>

    <div id="overlay" class="overlay"></div>

    <div class="notification" id="notification"></div>

    <div id="video-modal" class="video-modal">
        <div class="video-container">
            <div class="video-close" id="video-close">
                <i class="fas fa-times"></i>
            </div>
            <iframe class="video-player" id="video-player" frameborder="0" allowfullscreen>
            </iframe>
        </div>
    </div>

    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" data-section="forecasts" style="flex: 1;">
            <i class="nav-icon fas fa-futbol"></i>
            <span>Simples</span>
        </div>
        <div class="nav-item" data-section="ai-forecasts" style="flex: 1;">
            <i class="nav-icon fas fa-brain"></i>
            <span>Prédictions IA</span>
        </div>
        <div class="nav-item" data-section="profile" style="flex: 1;">
            <i class="nav-icon fas fa-user"></i>
            <span>Profil</span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, addDoc, onSnapshot, where, deleteDoc, serverTimestamp, updateDoc, arrayUnion, arrayRemove, limit, Timestamp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDTPLxUiA8lj82kqc6CyCPLQDITc0CtLUE",
            authDomain: "ichat-betai.firebaseapp.com",
            databaseURL: "https://ichat-betai-default-rtdb.firebaseio.com",
            projectId: "ichat-betai",
            storageBucket: "ichat-betai.appspot.com",
            messagingSenderId: "168337722600",
            appId: "1:168337722600:web:beb331f83cc4778c5b4d5d",
            measurementId: "G-STXPSZN7X8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Admin configuration
        const ADMIN_EMAILS = ['billionsjonnhy@gmail.com', 'louiskbn05@gmail.com'];

        // Lightning payment configuration
        const BLINK_API_KEY = "blink_GfLbFm7LuO6kWCee61eDGbHreslJIAj9WvkJ5INk3NfmuG8LewqYmwCmeu5i1P9D";
        const BLINK_WALLET_ID = "152f6bb5-fe7a-491c-b5d8-99bfd1853940";
        const BLINK_API_URL = "https://api.blink.sv/graphql";

        // Lightning payment variables
        let currentPaymentRequest = "";
        let autoCheckInterval = null;
        let currentPlanTypeForPayment = '';

        // Debug system
        let debugLogs = [];
        let debugPanelVisible = false;

        function addDebugLog(message, type = 'info', linkUrl = null) {
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            const log = {
                timestamp,
                message,
                type,
                linkUrl
            };
            
            debugLogs.push(log);
            
            // Keep only last 50 logs
            if (debugLogs.length > 50) {
                debugLogs.shift();
            }
            
            updateDebugPanel();
            
            // Show debug button if there are errors
            if (type === 'error') {
                document.getElementById('debug-toggle-btn').classList.add('active');
            }
        }

        function updateDebugPanel() {
            const content = document.getElementById('debug-log-content');
            content.innerHTML = '';
            
            debugLogs.forEach(log => {
                const item = document.createElement('div');
                item.className = `debug-log-item ${log.type}`;
                
                let messageContent = log.message;
                
                // Handle Firestore index links - make them clickable
                if (log.linkUrl) {
                    const linkText = `<a href="${log.linkUrl}" target="_blank" rel="noopener noreferrer" class="debug-log-link">Créer l'index requis ici</a>`;
                    messageContent = messageContent.replace(log.linkUrl, linkText);
                } else {
                    // Look for URLs in the message and make them clickable
                    const linkPattern = /https:\/\/console\.firebase\.google\.com[^\s)]+/g;
                    messageContent = messageContent.replace(linkPattern, (url) => {
                        return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="debug-log-link">Créer l'index requis ici</a>`;
                    });
                }
                
                item.innerHTML = `
                    <span class="debug-log-timestamp">${log.timestamp}</span>
                    ${messageContent}
                `;
                content.appendChild(item);
            });
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
        }

        function handleFirestoreError(error, operation) {
            let errorMessage = `Erreur ${operation}: ${error.code || 'inconnu'}`;
            let linkUrl = null;
            
            if (error.code === 'failed-precondition' || error.message.includes('index')) {
                // Extract index URL from error message if available
                const urlMatch = error.message.match(/https:\/\/console\.firebase\.google\.com[^\s)]+/);
                if (urlMatch) {
                    linkUrl = urlMatch[0];
                    errorMessage += `\n\nLien pour créer l'index: ${linkUrl}`;
                } else {
                    errorMessage += '\n\nUn index Firestore est requis. Consultez la console Firebase.';
                }
            }
            
            console.error(`${operation} error:`, error);
            addDebugLog(errorMessage, 'error', linkUrl);
            
            return errorMessage;
        }

        // Lightning payment functions (simplifiées)
        async function generateLightningInvoice(amount, planType) {
            addDebugLog(`Génération d'invoice pour ${amount} sats`, 'info');

            const mutation = `
                mutation CreateInvoice {
                    lnInvoiceCreate(input: {
                        walletId: "${BLINK_WALLET_ID}",
                        amount: ${amount},
                        memo: "Abonnement ${planType === 'daily' ? 'Quotidien' : 'Hebdomadaire'} - Pari Alliance"
                    }) {
                        invoice {
                            paymentRequest
                        }
                        errors {
                            message
                        }
                    }
                }
            `;

            try {
                const response = await fetch(BLINK_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-API-KEY": BLINK_API_KEY,
                    },
                    body: JSON.stringify({ query: mutation }),
                });

                const result = await response.json();

                if (result.data?.lnInvoiceCreate?.errors?.length) {
                    throw new Error("Erreur lors de la création de l'invoice");
                }

                const invoice = result.data.lnInvoiceCreate.invoice;
                if (!invoice) {
                    throw new Error("Invoice non reçue");
                }

                currentPaymentRequest = invoice.paymentRequest;
                addDebugLog("Invoice générée avec succès", 'success');

                // Start checking payment status every 3 seconds automatically
                if (autoCheckInterval) clearInterval(autoCheckInterval);
                autoCheckInterval = setInterval(checkLightningPaymentStatus, 3000);

                return currentPaymentRequest;

            } catch (error) {
                addDebugLog("Erreur génération invoice: " + error.message, 'error');
                throw error;
            }
        }

        async function checkLightningPaymentStatus() {
            if (!currentPaymentRequest) return;

            const query = `
                query CheckPaymentStatus {
                    lnInvoicePaymentStatus(input: { paymentRequest: "${currentPaymentRequest}" }) {
                        status
                    }
                }
            `;

            try {
                const response = await fetch(BLINK_API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-API-KEY": BLINK_API_KEY,
                    },
                    body: JSON.stringify({ query }),
                });

                const result = await response.json();

                if (result.errors) {
                    return;
                }

                const status = result.data?.lnInvoicePaymentStatus?.status;
                if (!status) return;

                const paymentStatusElement = document.getElementById('lightning-payment-status');

                if (status === "PAID") {
                    clearInterval(autoCheckInterval);
                    paymentStatusElement.className = 'payment-status success';
                    paymentStatusElement.innerHTML = '✅ Paiement reçu !';
                    addDebugLog("Paiement confirmé !", 'success');
                    
                    // Process subscription
                    await processSubscription(currentPlanTypeForPayment);
                    
                    setTimeout(() => {
                        hideLightningPaymentModal();
                        showNotification('Abonnement activé avec succès !', 'success');
                    }, 2000);
                } else {
                    paymentStatusElement.innerHTML = `⌛ Statut : ${status}`;
                }

            } catch (error) {
                addDebugLog("Erreur vérification paiement: " + error.message, 'error');
            }
        }

        function showLightningPaymentModal(amount, planType) {
            currentPlanTypeForPayment = planType;
            const modal = document.getElementById('lightning-payment-modal');
            const amountElement = document.getElementById('payment-amount-value');
            const statusElement = document.getElementById('lightning-payment-status');
            const invoiceElement = document.getElementById('lightning-invoice-text');

            // Reset modal state
            amountElement.textContent = `${amount} sats`;
            statusElement.className = 'payment-status pending';
            statusElement.innerHTML = '⏳ Génération de l\'invoice...';
            invoiceElement.textContent = '';
            currentPaymentRequest = '';

            modal.classList.add('active');

            addDebugLog(`Ouverture du modal de paiement Lightning pour ${amount} sats (plan ${planType})`, 'info');

            // Generate invoice
            generateLightningInvoice(amount, planType)
                .then(invoice => {
                    invoiceElement.textContent = invoice;
                    statusElement.innerHTML = '⏳ En attente de paiement...';
                })
                .catch(error => {
                    statusElement.className = 'payment-status error';
                    statusElement.innerHTML = '❌ Erreur génération invoice';
                });
        }

        function hideLightningPaymentModal() {
            const modal = document.getElementById('lightning-payment-modal');
            modal.classList.remove('active');
            
            if (autoCheckInterval) {
                clearInterval(autoCheckInterval);
                autoCheckInterval = null;
            }
            
            currentPaymentRequest = '';
            currentPlanTypeForPayment = '';
            addDebugLog('Fermeture du modal de paiement Lightning', 'info');
        }

        function copyLightningInvoice() {
            const invoiceText = document.getElementById('lightning-invoice-text').textContent;
            if (invoiceText) {
                navigator.clipboard.writeText(invoiceText).then(() => {
                    showNotification('Invoice copiée !', 'success');
                }).catch(err => {
                    addDebugLog("Erreur copie: " + err.message, 'error');
                });
            }
        }

        // Premium required modal functions
        function showPremiumRequiredModal() {
            const modal = document.getElementById('premium-required-modal');
            modal.classList.add('active');
            addDebugLog('Affichage de la popup premium requis', 'info');
        }

        function hidePremiumRequiredModal() {
            const modal = document.getElementById('premium-required-modal');
            modal.classList.remove('active');
            addDebugLog('Fermeture de la popup premium requis', 'info');
        }

        async function processSubscription(planType) {
            if (!currentUser) return;
            
            try {
                addDebugLog(`Début du traitement de l'abonnement ${planType}`, 'info');
                
                // Calculer la date d'expiration à minuit
                const now = new Date();
                let expiryDate;
                
                if (planType === 'daily') {
                    // Expiration le lendemain à minuit
                    expiryDate = new Date(now);
                    expiryDate.setDate(expiryDate.getDate() + 1);
                } else {
                    // Expiration dans 7 jours à minuit
                    expiryDate = new Date(now);
                    expiryDate.setDate(expiryDate.getDate() + 7);
                }
                
                // Forcer l'heure à minuit
                expiryDate.setHours(0, 0, 0, 0);
                
                // Update user data
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    currentPlan: planType,
                    planExpiryDate: expiryDate,
                    lastPaymentDate: now
                });
                
                addDebugLog(`Données utilisateur mises à jour: plan=${planType}, expiration=${expiryDate.toISOString()}`, 'success');
                
                // Add to Premium collection
                const premiumCollectionName = planType === 'daily' ? 'PremiumQuotidien' : 'PremiumHebdomadaire';
                const premiumRef = doc(db, premiumCollectionName, currentUser.uid);
                
                const premiumData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    planType: planType,
                    activatedAt: now,
                    expiresAt: expiryDate,
                    status: 'active'
                };
                
                await setDoc(premiumRef, premiumData);
                addDebugLog(`Utilisateur ajouté à la collection ${premiumCollectionName}`, 'success');
                
                currentPlanType = planType;
                
                // Update UI
                await loadUserSubscriptionData();
                updateBadges();
                
            } catch (error) {
                const errorMsg = handleFirestoreError(error, 'traitement de l\'abonnement');
                showNotification('Erreur lors de l\'activation de l\'abonnement', 'error');
            }
        }

        // Check if user's subscription has expired and remove from Premium collection
        async function checkSubscriptionExpiry() {
            if (!currentUser || !currentUserData) return;
            
            try {
                if (currentUserData.currentPlan && currentUserData.currentPlan !== 'free') {
                    // Améliorer la gestion des dates d'expiration
                    let expiryDate;
                    if (currentUserData.planExpiryDate) {
                        if (currentUserData.planExpiryDate.toDate) {
                            // Firestore Timestamp
                            expiryDate = currentUserData.planExpiryDate.toDate();
                        } else if (currentUserData.planExpiryDate instanceof Date) {
                            // JavaScript Date
                            expiryDate = currentUserData.planExpiryDate;
                        } else if (typeof currentUserData.planExpiryDate === 'string') {
                            // String ISO
                            expiryDate = new Date(currentUserData.planExpiryDate);
                        } else {
                            // Fallback: considérer comme expiré
                            expiryDate = new Date(0);
                        }
                    } else {
                        // Pas de date d'expiration définie, considérer comme expiré
                        expiryDate = new Date(0);
                    }
                    
                    const now = new Date();
                    
                    addDebugLog(`Vérification expiration: maintenant=${now.toISOString()}, expiration=${expiryDate.toISOString()}`, 'info');
                    
                    if (now >= expiryDate) {
                        addDebugLog(`Abonnement expiré depuis ${expiryDate.toLocaleString('fr-FR')}`, 'warning');
                        
                        // Remove from Premium collection
                        const premiumCollectionName = currentUserData.currentPlan === 'daily' ? 'PremiumQuotidien' : 'PremiumHebdomadaire';
                        const premiumRef = doc(db, premiumCollectionName, currentUser.uid);
                        
                        try {
                            await deleteDoc(premiumRef);
                            addDebugLog(`Utilisateur retiré de ${premiumCollectionName}`, 'success');
                        } catch (deleteError) {
                            addDebugLog(`Erreur suppression de ${premiumCollectionName}: ${deleteError.message}`, 'warning');
                        }
                        
                        // Update user to free plan
                        const userRef = doc(db, "Users", currentUser.uid);
                        await updateDoc(userRef, {
                            currentPlan: 'free',
                            planExpiryDate: null
                        });
                        
                        currentUserData.currentPlan = 'free';
                        currentUserData.planExpiryDate = null;
                        currentPlanType = 'free';
                        
                        addDebugLog('Utilisateur remis au plan gratuit', 'success');
                        showNotification('Votre abonnement a expiré. Vous êtes maintenant sur le plan gratuit.', 'info');
                        
                        await loadUserSubscriptionData();
                        updateBadges();
                        
                        return true; // Abonnement expiré
                    } else {
                        addDebugLog(`Abonnement encore valide jusqu'au ${expiryDate.toLocaleString('fr-FR')}`, 'success');
                        return false; // Abonnement encore valide
                    }
                }
            } catch (error) {
                handleFirestoreError(error, 'vérification de l\'expiration de l\'abonnement');
            }
            
            return false;
        }

        // Function to check if user has premium access
        function hasPremiumAccess() {
            return isAdmin || (currentPlanType && currentPlanType !== 'free');
        }

        // Initialize or check Admin collection
        async function initializeAdminCollection() {
            try {
                addDebugLog('Vérification de la collection Admin...', 'info');
                
                const adminCollectionRef = collection(db, "Admin");
                const adminSnapshot = await getDocs(adminCollectionRef);
                
                if (adminSnapshot.empty) {
                    addDebugLog('Collection Admin vide, création des admins par défaut...', 'info');
                    
                    // Create admin entries for each admin email
                    for (const email of ADMIN_EMAILS) {
                        const adminData = {
                            email: email,
                            isAdmin: true,
                            createdAt: serverTimestamp(),
                            addedBy: 'system'
                        };
                        
                        // Use email as document ID (replace dots and @ with underscores for valid doc ID)
                        const adminDocId = email.replace(/[@.]/g, '_');
                        await setDoc(doc(db, "Admin", adminDocId), adminData);
                        
                        addDebugLog(`Admin ajouté: ${email}`, 'success');
                    }
                    
                    addDebugLog(`Collection Admin initialisée avec ${ADMIN_EMAILS.length} administrateurs`, 'success');
                } else {
                    addDebugLog(`Collection Admin déjà existante avec ${adminSnapshot.size} entrées`, 'info');
                }
                
            } catch (error) {
                handleFirestoreError(error, 'initialisation de la collection Admin');
            }
        }

        // Check if current user is admin
        async function checkAdminStatus() {
            if (!currentUser) return false;
            
            try {
                // Check if user email is in admin list
                if (ADMIN_EMAILS.includes(currentUser.email)) {
                    addDebugLog(`Utilisateur ${currentUser.email} identifié comme administrateur`, 'success');
                    
                    // Also verify in Admin collection
                    const adminDocId = currentUser.email.replace(/[@.]/g, '_');
                    const adminRef = doc(db, "Admin", adminDocId);
                    const adminDoc = await getDoc(adminRef);
                    
                    if (adminDoc.exists() && adminDoc.data().isAdmin) {
                        isAdmin = true;
                        updateAdminStatus();
                        return true;
                    } else {
                        // If not in collection but in the email list, add them
                        const adminData = {
                            email: currentUser.email,
                            isAdmin: true,
                            createdAt: serverTimestamp(),
                            addedBy: 'system',
                            userId: currentUser.uid
                        };
                        
                        await setDoc(adminRef, adminData);
                        addDebugLog(`Admin ${currentUser.email} ajouté à la collection Admin`, 'success');
                        
                        isAdmin = true;
                        updateAdminStatus();
                        return true;
                    }
                } else {
                    isAdmin = false;
                    return false;
                }
                
            } catch (error) {
                handleFirestoreError(error, 'vérification du statut admin');
                return false;
            }
        }

        let isLoggedIn = false;
        let currentUser = null;
        let currentUserData = null;
        let isAdmin = false;
        let currentSection = 'forecasts'; // Section par défaut changée à 'forecasts'
        let isOnline = navigator.onLine;
        let eventsUnsubscribe = null;
        let profileImageFile = null;
        let profileUpdating = false;
        let isLoadingEvents = false;
        let profileNameChanged = false;
        let currentEventForDeletion = null;
        let currentForecastTab = 'combines';
        let lastViewedEventTimestamp = null;
        let hasNewEvents = false;
        let isSearchActive = false;
        let currentSearchContext = '';
        let selectedTheme = localStorage.getItem('parisAllianceTheme') || 'default';
        let selectedCardStyle = localStorage.getItem('parisAllianceCardStyle') || 'default';
        let selectedDisplayMode = localStorage.getItem('parisAllianceDisplayMode') || 'auto';
        let forecastsCache = {};
        let usersCache = {};
        let userSatsBalance = 0;
        let currentPlanType = '';

        // Function to get current date in YYYY-MM-DD format
        function getCurrentDateString() {
            return new Date().toISOString().slice(0, 10);
        }

        // Function to get previous date string
        function getDateString(daysAgo = 0) {
            const date = new Date();
            date.setDate(date.getDate() - daysAgo);
            return date.toISOString().slice(0, 10);
        }

        // Function to get forecast file URL for a specific date
        function getForecastFileUrl(dateString) {
            return `https://raw.githubusercontent.com/Jonnhy2255/Pronosoftbot/main/prédiction-${dateString}-analyse-ia.json`;
        }

        // Function to fetch forecasts from GitHub for a specific date
        async function fetchForecastsFromGitHub(dateString) {
            const fileUrl = getForecastFileUrl(dateString);
            
            try {
                addDebugLog(`Récupération des pronostics pour ${dateString}: ${fileUrl}`, 'info');
                
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        addDebugLog(`Fichier de pronostics non trouvé pour ${dateString}`, 'warning');
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                addDebugLog(`Pronostics récupérés avec succès pour ${dateString}`, 'success');
                
                return data;
            } catch (error) {
                addDebugLog(`Erreur lors de la récupération des pronostics pour ${dateString}: ${error.message}`, 'error');
                return null;
            }
        }

        // Function to process and categorize forecasts with new structure
        function processForecastData(data) {
            const processed = {
                combines: [],
                'ia-singles': [],
                safes: [],
                simple: []
            };

            if (!data) {
                return processed;
            }

            // Traiter les combinés depuis predictions_combinees.details
            if (data.predictions_combinees_ia && data.predictions_combinees_ia.details) {
                data.predictions_combinees_ia.details.forEach(forecast => {
                    processed.combines.push({
                        id: forecast.id,
                        name: forecast.name,
                        description: forecast.description,
                        matches: forecast.matches,
                        confidence: forecast.combined_confidence,
                        estimated_odds: forecast.estimated_odds,
                        type: 'combined',
                        size: forecast.size
                    });
                });
            }

            // Traiter les "Singles Premium" depuis ia_singles_premium.details
            if (data.ia_singles_premium && data.ia_singles_premium.details) {
                data.ia_singles_premium.details.forEach(forecast => {
                    processed['ia-singles'].push({
                        id: forecast.id,
                        HomeTeam: forecast.HomeTeam,
                        AwayTeam: forecast.AwayTeam,
                        confidence: forecast.confidence,
                        date: forecast.date,
                        league: forecast.league,
                        country: forecast.country,
                        prediction: forecast.prediction,
                        type: 'single',
                        score_prediction: forecast.score_prediction,
                        poisson_probabilities: forecast.poisson_probabilities,
                        poisson_top_scores: forecast.poisson_top_scores
                    });
                });
            }

            // Traiter les "safes" depuis recommandations.safest_bets
            if (data.recommandations && data.recommandations.safest_bets) {
                data.recommandations.safest_bets.forEach(forecast => {
                    processed.safes.push({
                        id: forecast.id,
                        HomeTeam: forecast.HomeTeam,
                        AwayTeam: forecast.AwayTeam,
                        confidence: forecast.confidence,
                        date: forecast.date,
                        league: forecast.league,
                        country: forecast.country,
                        prediction: forecast.prediction,
                        type: 'single',
                        score_prediction: forecast.score_prediction,
                        poisson_probabilities: forecast.poisson_probabilities,
                        poisson_top_scores: forecast.poisson_top_scores
                    });
                });
            }

            // Traiter les pronostics simples
            if (data.predictions_simples && data.predictions_simples.details) {
                data.predictions_simples.details.forEach(forecast => {
                    processed.simple.push({
                        id: forecast.id,
                        HomeTeam: forecast.HomeTeam,
                        AwayTeam: forecast.AwayTeam,
                        confidence: forecast.confidence,
                        date: forecast.date,
                        league: forecast.league,
                        country: forecast.country,
                        prediction: forecast.prediction,
                        type: 'single',
                        score_prediction: forecast.score_prediction,
                        poisson_probabilities: forecast.poisson_probabilities,
                        poisson_top_scores: forecast.poisson_top_scores
                    });
                });
            }

            return processed;
        }

        // Enhanced card system with 4 faces and improved touch handling
        function setupCardInteractions() {
            let touchStartX = 0;
            let touchStartY = 0;
            let currentCard = null;
            let cardState = 0; // 0: front, 1: details, 2: probabilities, 3: scores

            document.addEventListener('touchstart', function(e) {
                const card = e.target.closest('.forecast-item');
                if (!card) return;

                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                currentCard = card;
            }, { passive: true });

            document.addEventListener('touchend', function(e) {
                if (!currentCard) return;

                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchStartX - touchEndX;
                const diffY = touchStartY - touchEndY;

                // Check if it's a horizontal swipe (not vertical)
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    const container = currentCard.querySelector('.forecast-card-container');
                    const indicators = currentCard.querySelectorAll('.face-dot');
                    
                    // Get current state
                    let currentState = 0;
                    if (container.classList.contains('show-details')) currentState = 1;
                    else if (container.classList.contains('show-probabilities')) currentState = 2;
                    else if (container.classList.contains('show-scores')) currentState = 3;
                    
                    let newState;
                    if (diffX > 0) {
                        // Swipe left - next face
                        newState = (currentState + 1) % 4;
                    } else {
                        // Swipe right - previous face
                        newState = (currentState - 1 + 4) % 4;
                    }
                    
                    // Update card state
                    container.classList.remove('show-details', 'show-probabilities', 'show-scores');
                    indicators.forEach(dot => dot.classList.remove('active'));
                    
                    if (newState === 1) {
                        container.classList.add('show-details');
                        indicators[1].classList.add('active');
                    } else if (newState === 2) {
                        container.classList.add('show-probabilities');
                        indicators[2].classList.add('active');
                    } else if (newState === 3) {
                        container.classList.add('show-scores');
                        indicators[3].classList.add('active');
                    } else {
                        indicators[0].classList.add('active');
                    }
                }

                currentCard = null;
            }, { passive: true });

            // Support for clicks/taps
            document.addEventListener('click', function(e) {
                const card = e.target.closest('.forecast-item');
                if (!card) return;
                
                // Avoid toggle if clicking on a link or button
                if (e.target.closest('a, button')) return;
                
                const container = card.querySelector('.forecast-card-container');
                const indicators = card.querySelectorAll('.face-dot');
                
                // Get current state
                let currentState = 0;
                if (container.classList.contains('show-details')) currentState = 1;
                else if (container.classList.contains('show-probabilities')) currentState = 2;
                else if (container.classList.contains('show-scores')) currentState = 3;
                
                // Cycle to next face
                const newState = (currentState + 1) % 4;
                
                // Update card state
                container.classList.remove('show-details', 'show-probabilities', 'show-scores');
                indicators.forEach(dot => dot.classList.remove('active'));
                
                if (newState === 1) {
                    container.classList.add('show-details');
                    indicators[1].classList.add('active');
                } else if (newState === 2) {
                    container.classList.add('show-probabilities');
                    indicators[2].classList.add('active');
                } else if (newState === 3) {
                    container.classList.add('show-scores');
                    indicators[3].classList.add('active');
                } else {
                    indicators[0].classList.add('active');
                }
            });
        }

        function setupTheme() {
            const themeClasses = ['theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold', 'theme-purple', 'theme-teal', 'theme-indigo', 'theme-pink', 'theme-cyan', 'theme-lime', 'theme-amber', 'theme-deep-orange', 'theme-hightech'];
            
            document.documentElement.classList.remove(...themeClasses);
            
            if (selectedTheme !== 'default') {
                document.documentElement.classList.add(`theme-${selectedTheme}`);
            }
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const activeThemeOption = document.querySelector(`.theme-option[data-theme="${selectedTheme}"]`);
            if (activeThemeOption) {
                activeThemeOption.classList.add('active');
            }
        }

        function setupCardStyles() {
            const cardStyleClasses = ['card-style-gradient', 'card-style-glass', 'card-style-shadow', 'card-style-neon'];
            
            document.documentElement.classList.remove(...cardStyleClasses);
            
            if (selectedCardStyle !== 'default') {
                document.documentElement.classList.add(`card-style-${selectedCardStyle}`);
            }
            
            document.querySelectorAll('.card-style-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const activeCardStyleOption = document.querySelector(`.card-style-option[data-style="${selectedCardStyle}"]`);
            if (activeCardStyleOption) {
                activeCardStyleOption.classList.add('active');
            }
        }
        
        function setupDisplayMode() {
            // Appliquer le mode d'affichage sauvegardé
            if (selectedDisplayMode === 'light') {
                document.documentElement.classList.remove('dark', 'theme-hightech');
                document.getElementById('light-mode').checked = true;
            } else if (selectedDisplayMode === 'dark') {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('theme-hightech');
                document.getElementById('dark-mode').checked = true;
            } else if (selectedDisplayMode === 'hightech') {
                document.documentElement.classList.add('theme-hightech');
                document.documentElement.classList.remove('dark');
                document.getElementById('hightech-mode').checked = true;
            } else {
                // Mode auto basé sur les préférences système
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                    document.getElementById('dark-mode').checked = true;
                    selectedDisplayMode = 'dark';
                } else {
                    document.getElementById('light-mode').checked = true;
                    selectedDisplayMode = 'light';
                }
            }
            
            // Écouter les changements de préférences système seulement si en mode auto
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (selectedDisplayMode === 'auto') {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                        document.getElementById('dark-mode').checked = true;
                    } else {
                        document.documentElement.classList.remove('dark');
                        document.getElementById('light-mode').checked = true;
                    }
                }
            });
        }
        
        function setupConnectionMonitoring() {
            function updateConnectionStatus() {
                if (navigator.onLine) {
                    isOnline = true;
                } else {
                    isOnline = false;
                    showNotification("Pas de connexion internet.", "error");
                }
            }
            
            window.addEventListener('online', () => {
                showNotification("Connexion rétablie", "success");
                isOnline = true;
                
                setTimeout(() => {
                    if (isLoggedIn && (currentSection === 'ai-forecasts' || currentSection === 'forecasts' || currentSection === 'history')) {
                        if (currentSection === 'ai-forecasts') {
                            loadForecastsData(currentForecastTab);
                        } else if (currentSection === 'history') {
                            loadHistoryData();
                        } else {
                            loadForecastsData('simple');
                        }
                    }
                }, 1000);
            });
            
            window.addEventListener('offline', () => {
                updateConnectionStatus();
            });
            
            updateConnectionStatus();
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.classList.remove('show');
            
            setTimeout(() => {
                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    
                    setTimeout(() => {
                        notification.className = 'notification';
                        notification.textContent = '';
                    }, 300);
                }, 3000);
            }, 100);
        }

        async function loadUserSubscriptionData() {
            if (!currentUser) return;
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userSatsBalance = userData.satsBalance || 0;
                    currentPlanType = userData.currentPlan || 'free';
                    
                    // Update currentUserData with fresh data
                    currentUserData = { ...currentUserData, ...userData };
                    
                    // Check if subscription has expired
                    await checkSubscriptionExpiry();
                    
                    updateSubscriptionDisplay();
                    updateBadges();
                }
            } catch (error) {
                console.error('Erreur lors du chargement des données d\'abonnement:', error);
                addDebugLog(`Erreur chargement abonnement: ${error.message}`, 'error');
            }
        }

        function updateSubscriptionDisplay() {
            const satsBalanceElement = document.getElementById('user-sats-balance');
            if (satsBalanceElement) {
                satsBalanceElement.textContent = userSatsBalance;
            }
            
            // Update current plan display
            const currentPlanNameElement = document.getElementById('current-plan-name');
            const planExpiryInfoElement = document.getElementById('plan-expiry-info');
            
            if (currentPlanNameElement && planExpiryInfoElement) {
                if (currentPlanType === 'free') {
                    currentPlanNameElement.textContent = 'Plan Gratuit';
                    planExpiryInfoElement.textContent = 'Rechargez vos sats pour accéder aux plans premium';
                } else {
                    const planNames = {
                        'daily': 'Plan Quotidien',
                        'weekly': 'Plan Hebdomadaire'
                    };
                    currentPlanNameElement.textContent = planNames[currentPlanType] || 'Plan Premium';
                    
                    if (currentUserData?.planExpiryDate) {
                        let expiryDate;
                        if (currentUserData.planExpiryDate.toDate) {
                            expiryDate = currentUserData.planExpiryDate.toDate();
                        } else {
                            expiryDate = new Date(currentUserData.planExpiryDate);
                        }
                        planExpiryInfoElement.textContent = `Expire le ${expiryDate.toLocaleDateString('fr-FR')} à minuit`;
                    } else {
                        planExpiryInfoElement.textContent = 'Plan actif';
                    }
                }
            }
            
            // Update plan buttons
            const planButtons = document.querySelectorAll('.plan-button');
            planButtons.forEach(button => {
                button.disabled = false;
                if (button.id === 'daily-plan-btn') {
                    button.textContent = currentPlanType === 'daily' ? 'Plan actuel' : 'S\'abonner au plan quotidien';
                    button.disabled = currentPlanType === 'daily';
                } else {
                    button.textContent = currentPlanType === 'weekly' ? 'Plan actuel' : 'S\'abonner au plan hebdomadaire';
                    button.disabled = currentPlanType === 'weekly';
                }
            });
        }

        function updateBadges() {
            const premiumBadge = document.getElementById('premium-badge');
            const adminBadge = document.getElementById('admin-badge');
            
            if (premiumBadge) {
                if (hasPremiumAccess() && !isAdmin) {
                    premiumBadge.style.display = 'inline-block';
                } else {
                    premiumBadge.style.display = 'none';
                }
            }
            
            if (adminBadge) {
                if (isAdmin) {
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }
        }

        function playTutorialVideo(videoType) {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            // URLs YouTube démo pour les tutoriels
            const videoUrls = {
                'free-sats': 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                'buy-plan': 'https://www.youtube.com/embed/dQw4w9WgXcQ',
                'understand-predictions': 'https://www.youtube.com/embed/dQw4w9WgXcQ'
            };
            
            if (videoUrls[videoType]) {
                videoPlayer.src = videoUrls[videoType];
                videoModal.classList.add('active');
                history.pushState({ page: 'video-tutorial' }, '');
            } else {
                // Fallback: show notification for demo
                const videoTitles = {
                    'free-sats': 'Comment obtenir des sats gratuitement',
                    'buy-plan': 'Comment acheter un plan d\'abonnement',
                    'understand-predictions': 'Comment comprendre nos prédictions'
                };
                
                showNotification(`Vidéo "${videoTitles[videoType]}" bientôt disponible`, 'info');
            }
        }

        function closeVideoModal() {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            videoModal.classList.remove('active');
            videoPlayer.src = '';
        }

        function claimFreeSubscription() {
            const phoneNumber = '0565343227';
            const message = `Bonjour ! Je suis abonné aux trois réseaux sociaux de Pari Alliance (WhatsApp, Telegram et YouTube) et je souhaite réclamer mon abonnement premium gratuit. Merci !`;
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            addDebugLog('Ouverture de WhatsApp pour réclamer l\'abonnement gratuit', 'info');
            window.open(whatsappUrl, '_blank');
        }
        
        function setupUIEvents() {
            // Debug panel setup
            document.getElementById('debug-toggle-btn').addEventListener('click', function() {
                debugPanelVisible = !debugPanelVisible;
                const panel = document.getElementById('debug-log-panel');
                if (debugPanelVisible) {
                    panel.classList.add('active');
                    updateDebugPanel();
                } else {
                    panel.classList.remove('active');
                }
            });

            document.getElementById('debug-log-close').addEventListener('click', function() {
                debugPanelVisible = false;
                document.getElementById('debug-log-panel').classList.remove('active');
            });

            // Premium required modal events
            document.getElementById('premium-modal-subscribe').addEventListener('click', function() {
                hidePremiumRequiredModal();
                showSubscriptionSection();
            });

            document.getElementById('premium-modal-close').addEventListener('click', hidePremiumRequiredModal);

            // Lightning payment modal events
            document.getElementById('lightning-payment-close').addEventListener('click', hideLightningPaymentModal);
            document.getElementById('copy-lightning-invoice').addEventListener('click', copyLightningInvoice);
            document.getElementById('cancel-lightning-payment').addEventListener('click', hideLightningPaymentModal);

            // Claim free subscription button
            document.getElementById('claim-free-subscription').addEventListener('click', claimFreeSubscription);

            document.getElementById('header-menu-button').addEventListener('click', function() {
                document.getElementById('side-menu').classList.add('active');
                document.getElementById('side-menu-overlay').classList.add('active');
            });
            
            document.getElementById('side-menu-close').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('side-menu-overlay').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('menu-history').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showHistorySection();
            });

            document.getElementById('menu-subscription').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showSubscriptionSection();
            });

            document.getElementById('menu-tutorials').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTutorialsSection();
            });
            
            document.getElementById('menu-interface').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showInterfaceSection();
            });
            
            document.getElementById('menu-terms').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTermsDialog();
            });
            
            document.getElementById('terms-back').addEventListener('click', hideTermsDialog);
            
            document.getElementById('menu-about').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showAboutDialog();
            });
            
            document.getElementById('about-back').addEventListener('click', hideAboutDialog);
            
            document.getElementById('search-button').addEventListener('click', function() {
                toggleSearchBar();
            });
            
            document.getElementById('search-close').addEventListener('click', function() {
                hideSearchBar();
            });
            
            document.getElementById('search-input').addEventListener('input', function() {
                handleSearch(this.value);
            });
            
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });
            
            document.getElementById('bottom-nav').addEventListener('click', function(e) {
                const navItems = this.querySelectorAll('.nav-item');
                
                for (let i = 0; i < navItems.length; i++) {
                    const item = navItems[i];
                    const rect = item.getBoundingClientRect();
                    
                    if (e.clientX >= rect.left && e.clientX <= rect.right &&
                        e.clientY >= rect.top && e.clientY <= rect.bottom) {
                        
                        const section = item.getAttribute('data-section');
                        if (section === 'forecasts') {
                            showForecastsSection();
                        } else if (section === 'ai-forecasts') {
                            // Vérifier l'accès premium
                            if (hasPremiumAccess()) {
                                showAIForecastsSection();
                            } else {
                                showPremiumRequiredModal();
                            }
                        } else if (section === 'profile') {
                            showProfileSection();
                        }
                        
                        break;
                    }
                }
            });

            // Tutorial video events
            document.querySelectorAll('.tutorial-thumbnail').forEach(thumbnail => {
                thumbnail.addEventListener('click', function() {
                    const videoType = this.getAttribute('data-video');
                    playTutorialVideo(videoType);
                });
            });

            document.getElementById('video-close').addEventListener('click', closeVideoModal);

            // Subscription plan events with Lightning payment
            document.getElementById('daily-plan-btn').addEventListener('click', function() {
                if (currentPlanType !== 'daily') {
                    showLightningPaymentModal(10, 'daily');
                }
            });

            document.getElementById('weekly-plan-btn').addEventListener('click', function() {
                if (currentPlanType !== 'weekly') {
                    showLightningPaymentModal(60, 'weekly');
                }
            });
            
            document.querySelectorAll('.ai-forecast-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchAIForecastTab(tabId);
                });
            });
            
            // Display mode radio buttons
            document.querySelectorAll('input[name="display-mode"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        const mode = this.value;
                        selectedDisplayMode = mode;
                        
                        // Remove all mode classes
                        document.documentElement.classList.remove('dark', 'theme-hightech');
                        
                        if (mode === 'dark') {
                            document.documentElement.classList.add('dark');
                        } else if (mode === 'hightech') {
                            document.documentElement.classList.add('theme-hightech');
                        }
                        
                        localStorage.setItem('parisAllianceDisplayMode', mode);
                        
                        const modeNames = {
                            'light': 'Mode clair',
                            'dark': 'Mode sombre',
                            'hightech': 'Mode High-Tech'
                        };
                        
                        showNotification(`${modeNames[mode]} activé`, 'success');
                    }
                });
            });
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    selectedTheme = theme;
                    
                    const themeClasses = ['theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold', 'theme-purple', 'theme-teal', 'theme-indigo', 'theme-pink', 'theme-cyan', 'theme-lime', 'theme-amber', 'theme-deep-orange', 'theme-hightech'];
                    document.documentElement.classList.remove(...themeClasses);
                    
                    if (theme !== 'default') {
                        document.documentElement.classList.add(`theme-${theme}`);
                    }
                    
                    document.querySelectorAll('.theme-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    localStorage.setItem('parisAllianceTheme', theme);
                    
                    const themeNames = {
                        'default': 'Bleu',
                        'green': 'Vert',
                        'red': 'Rouge',
                        'orange': 'Orange',
                        'red-pink': 'Rouge-Rose',
                        'green-yellow': 'Vert-Jaune',
                        'blue-purple': 'Bleu-Violet',
                        'orange-gold': 'Orange-Doré',
                        'purple': 'Violet',
                        'teal': 'Turquoise',
                        'indigo': 'Indigo',
                        'pink': 'Rose',
                        'cyan': 'Cyan',
                        'lime': 'Lime',
                        'amber': 'Ambre',
                        'deep-orange': 'Orange Foncé',
                        'hightech': 'High-Tech'
                    };
                    
                    showNotification(`Thème ${themeNames[theme]} appliqué`, 'success');
                });
            });

            // Card style selector events
            document.querySelectorAll('.card-style-option').forEach(option => {
                option.addEventListener('click', function() {
                    const style = this.getAttribute('data-style');
                    selectedCardStyle = style;
                    
                    const cardStyleClasses = ['card-style-gradient', 'card-style-glass', 'card-style-shadow', 'card-style-neon'];
                    document.documentElement.classList.remove(...cardStyleClasses);
                    
                    if (style !== 'default') {
                        document.documentElement.classList.add(`card-style-${style}`);
                    }
                    
                    document.querySelectorAll('.card-style-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    localStorage.setItem('parisAllianceCardStyle', style);
                    
                    const styleNames = {
                        'default': 'Standard',
                        'gradient': 'Dégradé',
                        'glass': 'Verre',
                        'shadow': 'Ombre',
                        'neon': 'Néon'
                    };
                    
                    showNotification(`Style ${styleNames[style]} appliqué`, 'success');
                });
            });
            
            document.getElementById('logout-btn').addEventListener('click', showLogoutConfirmation);
            document.getElementById('logout-cancel').addEventListener('click', hideLogoutConfirmation);
            document.getElementById('logout-confirm').addEventListener('click', logoutUser);
            
            document.getElementById('delete-account-btn').addEventListener('click', showDeleteAccountConfirmation);
            
            document.getElementById('delete-account-cancel').addEventListener('click', hideDeleteAccountConfirmation);
            document.getElementById('delete-account-confirm').addEventListener('click', deleteAccount);
            
            document.getElementById('edit-profile-btn').addEventListener('click', showProfileEditDialog);
            document.getElementById('edit-profile-pic').addEventListener('click', showProfileEditDialog);
            
            document.getElementById('profile-edit-back').addEventListener('click', hideProfileEditDialog);
            document.getElementById('profile-upload-btn').addEventListener('click', function() {
                document.getElementById('profile-image-input').click();
            });
            
            document.getElementById('profile-image-input').addEventListener('change', handleProfileImageSelect);
            
            document.getElementById('save-display-name-btn').addEventListener('click', updateDisplayName);
            document.getElementById('save-profile-image-btn').addEventListener('click', updateProfileImage);
            
            document.getElementById('edit-display-name').addEventListener('input', function() {
                profileNameChanged = true;
                document.getElementById('save-display-name-btn').disabled = this.value.trim() === '';
            });
            
            document.getElementById('admin-notif-back').addEventListener('click', hideAdminNotificationDialog);
            document.getElementById('send-notification-btn').addEventListener('click', sendAdminNotification);
            
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                    return false;
                }
            });
            
            const touchableElements = document.querySelectorAll('.menu-button, .back-button, .search-button, .events-button, .info-button, .search-close');
            touchableElements.forEach(element => {
                element.addEventListener('touchstart', createRippleEffect);
            });
            
            window.addEventListener('popstate', handleBackButton);
            
            history.pushState({ page: 'main' }, '');

            // Setup card interactions for improved swipe handling
            setupCardInteractions();
        }
        
        function handleBackButton(event) {
            event.preventDefault();
            
            if (document.getElementById('premium-required-modal').classList.contains('active')) {
                hidePremiumRequiredModal();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.getElementById('lightning-payment-modal').classList.contains('active')) {
                hideLightningPaymentModal();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.querySelector('.confirmation-dialog.active')) {
                document.querySelectorAll('.confirmation-dialog.active').forEach(dialog => {
                    const cancelBtn = dialog.querySelector('.confirmation-cancel');
                    if (cancelBtn) cancelBtn.click();
                });
                history.pushState({ page: 'main' }, '');
                return;
            }

            if (document.getElementById('video-modal').classList.contains('active')) {
                closeVideoModal();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (isSearchActive) {
                hideSearchBar();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.getElementById('side-menu').classList.contains('active')) {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (currentSection !== 'forecasts') {
                showForecastsSection();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            const dialogs = [
                { id: 'about-dialog', backBtn: 'about-back' },
                { id: 'terms-dialog', backBtn: 'terms-back' },
                { id: 'profile-edit-dialog', backBtn: 'profile-edit-back' },
                { id: 'admin-notif-dialog', backBtn: 'admin-notif-back' }
            ];
            
            for (const dialog of dialogs) {
                if (document.getElementById(dialog.id).classList.contains('active')) {
                    document.getElementById(dialog.backBtn).click();
                    history.pushState({ page: 'main' }, '');
                    return;
                }
            }
            
            if (currentSection === 'forecasts') {
                history.pushState({ page: 'main' }, '');
            }
        }
        
        function createRippleEffect(e) {
            const button = e.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${e.touches[0].pageX - button.offsetLeft - diameter / 2}px`;
            circle.style.top = `${e.touches[0].pageY - button.offsetTop - diameter / 2}px`;
            circle.classList.add('ripple');
            
            const ripple = button.querySelector('.ripple');
            if (ripple) {
                ripple.remove();
            }
            
            button.appendChild(circle);
            
            setTimeout(() => {
                circle.remove();
            }, 600);
        }
        
        function toggleSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            if (isSearchActive) {
                hideSearchBar();
            } else {
                header.classList.add('search-active');
                searchContainer.classList.add('active');
                searchInput.focus();
                isSearchActive = true;
                
                history.pushState({ page: 'search' }, '');
                
                currentSearchContext = currentSection;
                
                if (currentSearchContext === 'ai-forecasts') {
                    searchInput.placeholder = 'Rechercher une prédiction...';
                } else if (currentSearchContext === 'events') {
                    searchInput.placeholder = 'Rechercher un événement...';
                } else if (currentSearchContext === 'forecasts') {
                    searchInput.placeholder = 'Rechercher un pronostic...';
                } else if (currentSearchContext === 'history') {
                    searchInput.placeholder = 'Rechercher dans l\'historique...';
                }
            }
        }
        
        function hideSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            searchContainer.classList.remove('active');
            searchContainer.classList.add('hiding');
            
            setTimeout(() => {
                header.classList.remove('search-active');
                searchInput.value = '';
                searchContainer.classList.remove('hiding');
                isSearchActive = false;
                
                handleSearch('');
            }, 300);
        }
        
        function handleSearch(query) {
            if (currentSearchContext === 'ai-forecasts') {
                filterForecasts(query);
            } else if (currentSearchContext === 'events') {
                filterEvents(query);
            } else if (currentSearchContext === 'forecasts') {
                filterForecasts(query);
            } else if (currentSearchContext === 'history') {
                filterHistory(query);
            }
        }

        function filterForecasts(query) {
            // Implement forecast filtering logic here
            // This would filter the displayed forecasts based on the search query
        }

        function filterEvents(query) {
            // Implement events filtering logic here
            // This would filter the displayed events based on the search query
        }

        function filterHistory(query) {
            // Implement history filtering logic here
            // This would filter the displayed historical forecasts based on the search query
        }
        
        function showTermsDialog() {
            document.getElementById('terms-dialog').classList.add('active');
            history.pushState({ page: 'terms' }, '');
        }
        
        function hideTermsDialog() {
            document.getElementById('terms-dialog').classList.remove('active');
        }
        
        function showAboutDialog() {
            document.getElementById('about-dialog').classList.add('active');
            history.pushState({ page: 'about' }, '');
        }
        
        function hideAboutDialog() {
            document.getElementById('about-dialog').classList.remove('active');
        }

        function showSubscriptionSection() {
            hideSearchBar();
            
            currentSection = 'subscription';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('subscription-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Abonnement';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            loadUserSubscriptionData();
            
            history.pushState({ page: 'subscription' }, '');
        }

        function showTutorialsSection() {
            hideSearchBar();
            
            currentSection = 'tutorials';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('tutorials-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Tutoriels';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            history.pushState({ page: 'tutorials' }, '');
        }

        function showHistorySection() {
            hideSearchBar();
            
            currentSection = 'history';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('history-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Historique';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
            `;
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            loadHistoryData();
            
            history.pushState({ page: 'history' }, '');
        }

        async function loadHistoryData() {
            const historyContent = document.getElementById('history-content');
            
            historyContent.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement de l'historique...</div>
                </div>
            `;

            try {
                // Charger seulement les données d'hier et d'avant-hier (pas d'aujourd'hui)
                const yesterday = getDateString(1);
                const dayBeforeYesterday = getDateString(2);
                
                // Fetch data for yesterday and day before yesterday
                const [yesterdayData, dayBeforeYesterdayData] = await Promise.all([
                    fetchForecastsFromGitHub(yesterday),
                    fetchForecastsFromGitHub(dayBeforeYesterday)
                ]);

                // Process the data
                const yesterdayProcessed = processForecastData(yesterdayData);
                const dayBeforeYesterdayProcessed = processForecastData(dayBeforeYesterdayData);

                // Display the history
                displayHistoryData(yesterdayProcessed, dayBeforeYesterdayProcessed);

            } catch (error) {
                addDebugLog(`Erreur chargement historique: ${error.message}`, 'error');
                historyContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="empty-state-title">Erreur de chargement</div>
                        <div class="empty-state-text">Impossible de charger l'historique des pronostics</div>
                    </div>
                `;
            }
        }

        function displayHistoryData(yesterdayData, dayBeforeYesterdayData) {
            const historyContent = document.getElementById('history-content');
            historyContent.innerHTML = '';

            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            
            const dayBeforeYesterday = new Date();
            dayBeforeYesterday.setDate(dayBeforeYesterday.getDate() - 2);

            // Display yesterday's data
            if (yesterdayData && Object.values(yesterdayData).some(arr => arr.length > 0)) {
                historyContent.appendChild(createHistoryDateSection(yesterday, yesterdayData));
            }

            // Display day before yesterday's data
            if (dayBeforeYesterdayData && Object.values(dayBeforeYesterdayData).some(arr => arr.length > 0)) {
                historyContent.appendChild(createHistoryDateSection(dayBeforeYesterday, dayBeforeYesterdayData));
            }

            // If no data available
            if (historyContent.children.length === 0) {
                historyContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <div class="empty-state-title">Aucun historique</div>
                        <div class="empty-state-text">L'historique des pronostics des 2 derniers jours apparaîtra ici</div>
                    </div>
                `;
            }
        }

        function createHistoryDateSection(date, data) {
            const section = document.createElement('div');
            
            const dateHeader = document.createElement('div');
            dateHeader.className = 'history-date-header';
            dateHeader.textContent = date.toLocaleDateString('fr-FR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            section.appendChild(dateHeader);

            // Display each category
            const categories = [
                { key: 'simple', title: 'Pronostics Simples' },
                { key: 'combines', title: 'Combinés IA' },
                { key: 'ia-singles', title: 'Singles Premium' },
                { key: 'safes', title: 'Pronostics Safes' }
            ];

            categories.forEach(category => {
                if (data[category.key] && data[category.key].length > 0) {
                    const categorySection = document.createElement('div');
                    categorySection.className = 'history-category-section';

                    const categoryTitle = document.createElement('div');
                    categoryTitle.className = 'history-category-title';
                    categoryTitle.textContent = `${category.title} (${data[category.key].length})`;
                    categorySection.appendChild(categoryTitle);

                    const forecastsList = document.createElement('div');
                    forecastsList.className = 'history-forecasts-list';

                    data[category.key].forEach(forecast => {
                        const historyItem = createHistoryForecastElement(forecast, category.key);
                        forecastsList.appendChild(historyItem);
                    });

                    categorySection.appendChild(forecastsList);
                    section.appendChild(categorySection);
                }
            });

            return section;
        }

        function createHistoryForecastElement(forecastData, type) {
            const element = document.createElement('div');
            element.className = 'history-forecast-item';

            let content = '';
            
            if (type === 'combines') {
                content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: bold;">${forecastData.name || 'Combiné'}</div>
                        <div class="forecast-status pending">À venir</div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.8;">
                        ${forecastData.matches ? forecastData.matches.length : 0} matchs • Confiance: ${forecastData.confidence || 'N/A'}%
                    </div>
                    ${forecastData.estimated_odds ? `<div style="font-size: 12px; margin-top: 4px;">Cote estimée: ${forecastData.estimated_odds}</div>` : ''}
                `;
            } else {
                content = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: bold;">${forecastData.HomeTeam || 'Équipe 1'} vs ${forecastData.AwayTeam || 'Équipe 2'}</div>
                        <div class="forecast-status pending">À venir</div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.8;">
                        ${forecastData.prediction || 'N/A'} • Confiance: ${forecastData.confidence || 'N/A'}%
                    </div>
                    <div style="font-size: 11px; margin-top: 4px; opacity: 0.6;">
                        ${forecastData.league || 'Compétition'} • ${forecastData.country || 'Pays'}
                    </div>
                `;
            }

            element.innerHTML = content;
            return element;
        }
        
        function switchAIForecastTab(tabId) {
            currentForecastTab = tabId;
            
            document.querySelectorAll('.ai-forecast-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.ai-forecasts-content').forEach(content => {
                if (content.id === `${tabId}-content`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            loadForecastsData(tabId);
        }
        
        function showAIForecastsSection() {
            // Vérifier l'accès premium
            if (!hasPremiumAccess()) {
                showPremiumRequiredModal();
                return;
            }

            hideSearchBar();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'ai-forecasts') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'ai-forecasts';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('ai-forecasts-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Prédictions IA';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadForecastsData(currentForecastTab);
        }
        
        function showInterfaceSection() {
            hideSearchBar();
            
            currentSection = 'interface';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('interface-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Interface';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            setupTheme();
            setupCardStyles();
            setupDisplayMode();
            
            history.pushState({ page: 'interface' }, '');
        }
        
        async function loadForecastsData(tabType) {
            if (forecastsCache[tabType]) {
                displayForecastsFromCache(tabType);
                return;
            }
            
            let listElement;
            if (currentSection === 'ai-forecasts') {
                listElement = document.getElementById(`${tabType}-list`);
            } else {
                listElement = document.getElementById('simple-forecasts-list');
            }
            
            if (!listElement) return;
            
            listElement.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des pronostics...</div>
                </div>
            `;
            
            try {
                // Fetch forecasts from GitHub
                const githubData = await fetchForecastsFromGitHub(getCurrentDateString());
                
                if (!githubData) {
                    listElement.innerHTML = `
                        <div class="no-forecasts">
                            <i class="fas fa-calendar-day"></i>
                            <div class="empty-state-title">Aucune prédiction fiable pour cette section</div>
                            <div class="empty-state-text">Aucun pronostic disponible pour aujourd'hui (${getCurrentDateString()})</div>
                        </div>
                    `;
                    return;
                }
                
                // Process and categorize the data
                const processedData = processForecastData(githubData);
                
                // Cache the processed data
                Object.keys(processedData).forEach(type => {
                    forecastsCache[type] = processedData[type];
                });
                
                if (currentSection === 'ai-forecasts') {
                    displayForecastsFromCache(tabType);
                } else {
                    displayForecastsFromCache('simple');
                }
                
            } catch (error) {
                addDebugLog(`Erreur chargement pronostics: ${error.message}`, 'error');
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="empty-state-title">Aucune prédiction fiable pour cette section</div>
                        <div class="empty-state-text">Impossible de charger les pronostics depuis GitHub</div>
                    </div>
                `;
            }
        }
        
        function displayForecastsFromCache(tabType) {
            let listElement;
            if (currentSection === 'ai-forecasts') {
                listElement = document.getElementById(`${tabType}-list`);
            } else {
                listElement = document.getElementById('simple-forecasts-list');
            }
            
            if (!listElement || !forecastsCache[tabType]) return;
            
            listElement.innerHTML = '';
            
            const forecasts = forecastsCache[tabType];
            
            if (forecasts.length === 0) {
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-futbol"></i>
                        <div class="empty-state-title">Aucune prédiction fiable pour cette section</div>
                        <div class="empty-state-text">Aucun pronostic disponible pour cette catégorie</div>
                   </div>
                `;
                return;
            }
            
            forecasts.forEach((forecast, index) => {
                const forecastElement = createForecastElement(forecast, tabType, index);
                listElement.appendChild(forecastElement);
            });
        }
        
        function createForecastElement(forecastData, type, index) {
            const element = document.createElement('div');
            element.className = 'forecast-item';
            
            let content = '';
            
            if (type === 'combines') {
                content = createCombinedForecastContent(forecastData);
            } else {
                content = createSingleForecastContent(forecastData);
            }
            
            element.innerHTML = content;
            return element;
        }
        
        function createCombinedForecastContent(forecast) {
            const matchesDisplay = forecast.matches ? forecast.matches.slice(0, 3).map(match => {
                return `
                    <div class="match-detail">
                        <div class="match-name">${match.HomeTeam} vs ${match.AwayTeam}</div>
                        <div class="match-prediction">${match.prediction}</div>
                        <div class="match-confidence">Confiance: ${match.confidence}%</div>
                    </div>
                `;
            }).join('') : '';
            
            const remainingMatches = forecast.matches && forecast.matches.length > 3 ? 
                `<div style="text-align: center; font-size: 12px; opacity: 0.7; margin-top: 8px;">
                    +${forecast.matches.length - 3} autres matchs
                </div>` : '';
            
            return `
                <div class="forecast-card-container">
                    <div class="forecast-face forecast-front">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">${forecast.name || 'Combiné IA'}</div>
                            <div class="forecast-status pending">À venir</div>
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div style="font-size: 48px; color: var(--card-accent); margin-bottom: 10px;">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div style="font-size: 14px; opacity: 0.8;">Combiné intelligent</div>
                        </div>
                        
                        <div class="forecast-confidence">
                            <span>Confiance</span>
                            <div class="confidence-bar-container">
                                <div class="confidence-bar" style="width: ${forecast.confidence || 0}%"></div>
                            </div>
                            <span>${forecast.confidence || 0}%</span>
                        </div>
                        
                        ${forecast.estimated_odds ? `
                        <div class="estimated-odds">
                            Cote estimée: ${forecast.estimated_odds}
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="forecast-face forecast-details">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Détails du combiné</div>
                        </div>
                        
                        <div class="forecast-description">
                            ${forecast.description || 'Combiné généré par intelligence artificielle basé sur des analyses avancées.'}
                        </div>
                        
                        <div class="combined-matches">
                            <div class="combined-matches-title">Matchs inclus (${forecast.matches ? forecast.matches.length : 0})</div>
                            ${matchesDisplay}
                            ${remainingMatches}
                        </div>
                        
                        ${forecast.size ? `
                        <div style="text-align: center; margin-top: 15px; font-weight: bold; color: var(--card-accent);">
                            Taille du combiné: ${forecast.size}
                        </div>
                        ` : ''}
                    </div>
                    
                    <div class="forecast-face forecast-probabilities">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Analyse des probabilités</div>
                        </div>
                        
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-chart-line" style="font-size: 40px; color: var(--card-accent); margin-bottom: 15px;"></i>
                            <div style="font-size: 14px; opacity: 0.8; line-height: 1.5;">
                                Analyse probabiliste avancée basée sur:
                                <br>• Historique des performances
                                <br>• Forme actuelle des équipes
                                <br>• Statistiques head-to-head
                                <br>• Facteurs environnementaux
                            </div>
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px;">
                            <div style="font-weight: bold; margin-bottom: 8px;">Recommandation IA</div>
                            <div style="font-size: 14px;">
                                Ce combiné présente un excellent rapport risque/rendement selon nos algorithmes.
                            </div>
                        </div>
                    </div>
                    
                    <div class="forecast-face forecast-scores">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Métriques avancées</div>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                                <span>Fiabilité</span>
                                <span style="font-weight: bold; color: var(--card-accent);">${forecast.confidence || 0}%</span>
                            </div>
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                                <span>Nombre de matchs</span>
                                <span style="font-weight: bold; color: var(--card-accent);">${forecast.matches ? forecast.matches.length : 0}</span>
                            </div>
                            
                            ${forecast.estimated_odds ? `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                                <span>Cote estimée</span>
                                <span style="font-weight: bold; color: var(--card-accent);">${forecast.estimated_odds}</span>
                            </div>
                            ` : ''}
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: rgba(0,0,0,0.05); border-radius: 8px;">
                                <span>Type</span>
                                <span style="font-weight: bold; color: var(--card-accent);">Combiné IA</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="face-indicator">
                        <div class="face-dot active"></div>
                        <div class="face-dot"></div>
                        <div class="face-dot"></div>
                        <div class="face-dot"></div>
                    </div>
                    
                    <div class="swipe-instruction">Glissez pour voir plus</div>
                </div>
            `;
        }
        
        function createSingleForecastContent(forecast) {
            const poissonDisplay = forecast.poisson_probabilities ? `
                <div class="poisson-probabilities">
                    <div class="poisson-title">Probabilités Poisson</div>
                    ${Object.entries(forecast.poisson_probabilities).map(([key, value]) => `
                        <div class="poisson-row">
                            <span>${key}</span>
                            <span style="font-weight: bold;">${value}%</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';
            
            const topScoresDisplay = forecast.poisson_top_scores ? `
                <div class="exact-scores-section">
                    <div class="exact-scores-title">Scores les plus probables</div>
                    ${forecast.poisson_top_scores.map(score => `
                        <div class="exact-score-item">
                            <div class="exact-score-match">${score.score}</div>
                            <div class="exact-score-probability">${score.probability}%</div>
                        </div>
                    `).join('')}
                </div>
            ` : '';
            
            return `
                <div class="forecast-card-container">
                    <div class="forecast-face forecast-front">
                        <div class="forecast-header">
                            <div style="font-size: 14px; color: var(--card-accent);">${forecast.league || 'Compétition'}</div>
                            <div class="forecast-status pending">À venir</div>
                        </div>
                        
                        <div class="forecast-match">
                            <div class="forecast-team">
                                <div class="forecast-team-logo">
                                    <i class="fas fa-shield-alt" style="color: var(--card-accent);"></i>
                                </div>
                                <div class="forecast-team-name">${forecast.HomeTeam || 'Équipe 1'}</div>
                            </div>
                            
                            <div class="forecast-vs">VS</div>
                            
                            <div class="forecast-team">
                                <div class="forecast-team-logo">
                                    <i class="fas fa-shield-alt" style="color: var(--card-accent);"></i>
                                </div>
                                <div class="forecast-team-name">${forecast.AwayTeam || 'Équipe 2'}</div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="font-weight: bold; font-size: 16px; color: var(--card-accent); margin-bottom: 5px;">
                                ${forecast.prediction || 'Prédiction'}
                            </div>
                            ${forecast.score_prediction ? `
                            <div style="font-size: 14px; opacity: 0.8;">
                                Score prédit: ${forecast.score_prediction}
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="forecast-confidence">
                            <span>Confiance</span>
                            <div class="confidence-bar-container">
                                <div class="confidence-bar" style="width: ${forecast.confidence || 0}%"></div>
                            </div>
                            <span>${forecast.confidence || 0}%</span>
                        </div>
                        
                        <div class="forecast-date">
                            ${forecast.date || getCurrentDateString()} • ${forecast.country || 'International'}
                        </div>
                    </div>
                    
                    <div class="forecast-face forecast-details">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Détails du match</div>
                        </div>
                        
                        <div class="forecast-description">
                            <strong>Compétition:</strong> ${forecast.league || 'N/A'}<br>
                            <strong>Pays:</strong> ${forecast.country || 'N/A'}<br>
                            <strong>Date:</strong> ${forecast.date || getCurrentDateString()}<br>
                            <strong>Prédiction:</strong> ${forecast.prediction || 'N/A'}
                            ${forecast.score_prediction ? `<br><strong>Score prédit:</strong> ${forecast.score_prediction}` : ''}
                        </div>
                        
                        <div style="background: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px; margin-top: 15px;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: var(--card-accent);">
                                <i class="fas fa-lightbulb" style="margin-right: 5px;"></i>
                                Analyse IA
                            </div>
                            <div style="font-size: 14px; line-height: 1.4;">
                                Cette prédiction est basée sur l'analyse de multiples facteurs: forme récente, historique des confrontations, statistiques d'équipe et conditions de jeu.
                            </div>
                        </div>
                    </div>
                    
                    <div class="forecast-face forecast-probabilities">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Analyse probabiliste</div>
                        </div>
                        
                        ${poissonDisplay || `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-chart-pie" style="font-size: 40px; color: var(--card-accent); margin-bottom: 15px;"></i>
                            <div style="font-size: 14px; opacity: 0.8; line-height: 1.5;">
                                Analyse des probabilités basée sur:
                                <br>• Performances récentes
                                <br>• Statistiques historiques
                                <br>• Forme des joueurs clés
                                <br>• Conditions de jeu
                            </div>
                        </div>
                        `}
                    </div>
                    
                    <div class="forecast-face forecast-scores">
                        <div class="forecast-header">
                            <div style="font-size: 16px; color: var(--card-accent);">Scores prédits</div>
                        </div>
                        
                        ${topScoresDisplay || `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-calculator" style="font-size: 40px; color: var(--card-accent); margin-bottom: 15px;"></i>
                            <div style="font-size: 14px; opacity: 0.8; line-height: 1.5;">
                                ${forecast.score_prediction ? `
                                <div style="font-size: 24px; font-weight: bold; color: var(--card-accent); margin: 15px 0;">
                                    ${forecast.score_prediction}
                                </div>
                                <div>Score le plus probable selon notre IA</div>
                                ` : 'Analyse des scores en cours...'}
                            </div>
                        </div>
                        `}
                    </div>
                    
                    <div class="face-indicator">
                        <div class="face-dot active"></div>
                        <div class="face-dot"></div>
                        <div class="face-dot"></div>
                        <div class="face-dot"></div>
                    </div>
                    
                    <div class="swipe-instruction">Glissez pour voir plus</div>
                </div>
            `;
        }
        
        function showForecastsSection() {
            hideSearchBar();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'forecasts') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'forecasts';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('forecasts-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Simples';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadForecastsData('simple');
        }
        
        function showProfileSection() {
            hideSearchBar();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'profile') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'profile';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('profile-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Profil';
            
            document.getElementById('header-action').innerHTML = `
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            updateAdminStatus();
            updateBadges();
        }
        
        function showEventsSection() {
            hideSearchBar();
            
            currentSection = 'events';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('events-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Événements';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
            `;
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            loadEvents();
            
            history.pushState({ page: 'events' }, '');
        }
        
        function updateAdminStatus() {
            const profileName = document.getElementById('profile-name-text');
            const profileEmail = document.getElementById('profile-email');
            const adminBadge = document.getElementById('admin-badge');
            
            if (currentUser && currentUserData) {
                profileName.textContent = currentUserData.displayName || currentUser.email.split('@')[0];
                profileEmail.textContent = currentUser.email;
                
                if (isAdmin) {
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }
        }
        
        async function loadEvents() {
            if (isLoadingEvents) return;
            isLoadingEvents = true;
            
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des événements...</div>
                </div>
            `;
            
            try {
                const eventsRef = collection(db, "Events");
                const eventsQuery = query(eventsRef, orderBy("createdAt", "desc"), limit(50));
                
                if (eventsUnsubscribe) {
                    eventsUnsubscribe();
                }
                
                eventsUnsubscribe = onSnapshot(eventsQuery, 
                    (snapshot) => {
                        displayEvents(snapshot.docs);
                        isLoadingEvents = false;
                    },
                    (error) => {
                        handleFirestoreError(error, 'chargement des événements');
                        eventsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-exclamation-circle"></i>
                                <div class="empty-state-title">Erreur de chargement</div>
                                <div class="empty-state-text">Impossible de charger les événements</div>
                            </div>
                        `;
                        isLoadingEvents = false;
                    }
                );
                
            } catch (error) {
                handleFirestoreError(error, 'chargement des événements');
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="empty-state-title">Erreur de chargement</div>
                        <div class="empty-state-text">Impossible de charger les événements</div>
                    </div>
                `;
                isLoadingEvents = false;
            }
        }
        
        function displayEvents(eventDocs) {
            const eventsList = document.getElementById('events-list');
            
            if (eventDocs.length === 0) {
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <div class="empty-state-title">Aucun événement</div>
                        <div class="empty-state-text">Les événements apparaîtront ici</div>
                    </div>
                `;
                return;
            }
            
            eventsList.innerHTML = '';
            
            eventDocs.forEach(doc => {
                const eventData = doc.data();
                const eventElement = createEventElement(doc.id, eventData);
                eventsList.appendChild(eventElement);
            });
        }
        
        function createEventElement(eventId, eventData) {
            const element = document.createElement('div');
            element.className = 'admin-notification';
            element.innerHTML = `
                <div class="admin-notification-header">
                    <div class="admin-notification-title">
                        <i class="fas fa-bell"></i>
                        ${eventData.title || 'Événement'}
                    </div>
                </div>
                <div class="admin-notification-content">
                    ${eventData.content || ''}
                </div>
                <div class="admin-notification-footer">
                    ${eventData.createdAt ? formatEventTime(eventData.createdAt.toDate()) : 'Date inconnue'}
                </div>
                ${isAdmin ? `
                <div class="event-actions">
                    <button class="event-action-btn delete" onclick="deleteEvent('${eventId}')">
                        <i class="fas fa-trash"></i>
                        Supprimer
                    </button>
                </div>
                ` : ''}
            `;
            return element;
        }
        
        function formatEventTime(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffMins < 1) return 'À l\'instant';
            if (diffMins < 60) return `Il y a ${diffMins} min`;
            if (diffHours < 24) return `Il y a ${diffHours}h`;
            if (diffDays < 7) return `Il y a ${diffDays} jour${diffDays > 1 ? 's' : ''}`;
            
            return date.toLocaleDateString('fr-FR', {
                day: 'numeric',
                month: 'short',
                year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
            });
        }
        
        function updateLastViewedEventTimestamp() {
            lastViewedEventTimestamp = new Date();
            localStorage.setItem('parisAllianceLastViewedEvent', lastViewedEventTimestamp.getTime().toString());
        }
        
        function hideEventNotificationDot() {
            hasNewEvents = false;
            const dot = document.getElementById('events-notification-dot');
            if (dot) {
                dot.classList.remove('active');
            }
        }
        
        async function deleteEvent(eventId) {
            try {
                await deleteDoc(doc(db, "Events", eventId));
                showNotification('Événement supprimé', 'success');
            } catch (error) {
                handleFirestoreError(error, 'suppression de l\'événement');
                showNotification('Erreur lors de la suppression', 'error');
            }
        }
        
        function showLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }
        
        function hideLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        function showDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }
        
        function hideDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        async function logoutUser() {
            try {
                await signOut(auth);
                hideLogoutConfirmation();
                showNotification('Déconnecté avec succès', 'success');
            } catch (error) {
                console.error('Erreur de déconnexion:', error);
                showNotification('Erreur lors de la déconnexion', 'error');
            }
        }
        
        async function deleteAccount() {
            if (!currentUser) return;
            
            try {
                hideDeleteAccountConfirmation();
                
                showNotification('Suppression du compte en cours...', 'info');
                
                const userRef = doc(db, "Users", currentUser.uid);
                await deleteDoc(userRef);
                
                await deleteUser(currentUser);
                
                showNotification('Compte supprimé avec succès', 'success');
                
            } catch (error) {
                console.error('Erreur suppression compte:', error);
                
                if (error.code === 'auth/requires-recent-login') {
                    showNotification('Veuillez vous reconnecter puis réessayer', 'error');
                } else {
                    showNotification('Erreur lors de la suppression du compte', 'error');
                }
            }
        }
        
        function showProfileEditDialog() {
            document.getElementById('profile-edit-dialog').classList.add('active');
            
            if (currentUserData && currentUserData.displayName) {
                document.getElementById('edit-display-name').value = currentUserData.displayName;
            }
            
            document.getElementById('save-display-name-btn').disabled = true;
            profileNameChanged = false;
            
            history.pushState({ page: 'profile-edit' }, '');
        }
        
        function hideProfileEditDialog() {
            document.getElementById('profile-edit-dialog').classList.remove('active');
            profileImageFile = null;
            
            const preview = document.getElementById('profile-image-preview');
            preview.innerHTML = '<i class="fas fa-user"></i>';
        }
        
        function handleProfileImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('L\'image ne doit pas dépasser 5 MB', 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showNotification('Veuillez sélectionner une image valide', 'error');
                return;
            }
            
            profileImageFile = file;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('profile-image-preview');
                preview.innerHTML = `<img src="${e.target.result}" alt="Aperçu">`;
            };
            reader.readAsDataURL(file);
            
            document.getElementById('save-profile-image-btn').disabled = false;
        }
        
        async function updateDisplayName() {
            if (profileUpdating) return;
            
            const newDisplayName = document.getElementById('edit-display-name').value.trim();
            
            if (!newDisplayName) {
                document.getElementById('edit-display-name-error').style.display = 'block';
                return;
            }
            
            profileUpdating = true;
            const button = document.getElementById('save-display-name-btn');
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            button.disabled = true;
            loader.style.display = 'inline-block';
            text.textContent = 'Enregistrement...';
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    displayName: newDisplayName
                });
                
                currentUserData.displayName = newDisplayName;
                updateAdminStatus();
                
                showNotification('Nom d\'utilisateur mis à jour', 'success');
                profileNameChanged = false;
                button.disabled = true;
                
            } catch (error) {
                handleFirestoreError(error, 'mise à jour du nom d\'utilisateur');
                showNotification('Erreur lors de la mise à jour', 'error');
                button.disabled = false;
            } finally {
                profileUpdating = false;
                loader.style.display = 'none';
                text.textContent = 'Enregistrer';
            }
        }
        
        async function updateProfileImage() {
            if (!profileImageFile || profileUpdating) return;
            
            profileUpdating = true;
            const button = document.getElementById('save-profile-image-btn');
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            button.disabled = true;
            loader.style.display = 'inline-block';
            text.textContent = 'Téléchargement...';
            
            try {
                const base64 = await fileToBase64(profileImageFile);
                
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    profileImage: base64
                });
                
                currentUserData.profileImage = base64;
                
                const mainProfilePic = document.querySelector('.profile-header .profile-pic');
                if (mainProfilePic) {
                    mainProfilePic.innerHTML = `<img src="${base64}" alt="Photo de profil">`;
                }
                
                showNotification('Photo de profil mise à jour', 'success');
                profileImageFile = null;
                
            } catch (error) {
                handleFirestoreError(error, 'mise à jour de la photo de profil');
                showNotification('Erreur lors de la mise à jour', 'error');
            } finally {
                profileUpdating = false;
                button.disabled = true;
                loader.style.display = 'none';
                text.textContent = 'Enregistrer la photo';
            }
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        function showAdminNotificationDialog() {
            document.getElementById('admin-notif-dialog').classList.add('active');
            history.pushState({ page: 'admin-notification' }, '');
        }
        
        function hideAdminNotificationDialog() {
            document.getElementById('admin-notif-dialog').classList.remove('active');
            
            document.getElementById('notif-title').value = '';
            document.getElementById('notif-content').value = '';
            document.getElementById('notif-type').value = 'info';
            
            document.getElementById('notif-title-error').style.display = 'none';
            document.getElementById('notif-content-error').style.display = 'none';
        }
        
        async function sendAdminNotification() {
            const title = document.getElementById('notif-title').value.trim();
            const content = document.getElementById('notif-content').value.trim();
            const type = document.getElementById('notif-type').value;
            
            document.getElementById('notif-title-error').style.display = 'none';
            document.getElementById('notif-content-error').style.display = 'none';
            
            let hasError = false;
            
            if (!title) {
                document.getElementById('notif-title-error').style.display = 'block';
                hasError = true;
            }
            
            if (!content) {
                document.getElementById('notif-content-error').style.display = 'block';
                hasError = true;
            }
            
            if (hasError) return;
            
            const button = document.getElementById('send-notification-btn');
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            button.disabled = true;
            loader.style.display = 'inline-block';
            text.textContent = 'Envoi...';
            
            try {
                const eventData = {
                    title: title,
                    content: content,
                    type: type,
                    createdAt: serverTimestamp(),
                    createdBy: currentUser.uid,
                    createdByEmail: currentUser.email
                };
                
                await addDoc(collection(db, "Events"), eventData);
                
                hideAdminNotificationDialog();
                showNotification('Notification envoyée avec succès', 'success');
                
            } catch (error) {
                handleFirestoreError(error, 'envoi de la notification');
                showNotification('Erreur lors de l\'envoi', 'error');
            } finally {
                button.disabled = false;
                loader.style.display = 'none';
                text.textContent = 'Envoyer la notification';
            }
        }
        
        function setupAuthEvents() {
            document.getElementById('login-tab').addEventListener('click', function() {
                switchAuthTab('login');
            });
            
            document.getElementById('register-tab').addEventListener('click', function() {
                switchAuthTab('register');
            });
            
            document.getElementById('goto-register').addEventListener('click', function(e) {
                e.preventDefault();
                switchAuthTab('register');
            });
            
            document.getElementById('goto-login').addEventListener('click', function(e) {
                e.preventDefault();
                switchAuthTab('login');
            });
            
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            
            document.getElementById('login-email').addEventListener('input', function() {
                document.getElementById('login-email-error').style.display = 'none';
            });
            
            document.getElementById('login-password').addEventListener('input', function() {
                document.getElementById('login-password-error').style.display = 'none';
            });
            
            document.getElementById('register-email').addEventListener('input', function() {
                document.getElementById('register-email-error').style.display = 'none';
            });
            
            document.getElementById('register-password').addEventListener('input', function() {
                document.getElementById('register-password-error').style.display = 'none';
            });
            
            document.getElementById('register-confirm-password').addEventListener('input', function() {
                document.getElementById('register-confirm-password-error').style.display = 'none';
            });
        }
        
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.getElementById('login-tab').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.getElementById('register-tab').classList.add('active');
                document.getElementById('register-form').classList.add('active');
            }
        }
        
        async function handleLogin() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            document.getElementById('login-email-error').style.display = 'none';
            document.getElementById('login-password-error').style.display = 'none';
            
            let hasError = false;
            
            if (!email || !isValidEmail(email)) {
                document.getElementById('login-email-error').style.display = 'block';
                hasError = true;
            }
            
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                hasError = true;
            }
            
            if (hasError) return;
            
            const button = document.getElementById('loginBtn');
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            button.disabled = true;
            loader.style.display = 'inline-block';
            text.textContent = 'Connexion...';
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                
            } catch (error) {
                console.error('Erreur de connexion:', error);
                
                let errorMessage = 'Erreur de connexion';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Aucun compte trouvé avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mot de passe incorrect';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Trop de tentatives. Réessayez plus tard';
                }
                
                showLogMessage('login-log', errorMessage, 'error');
                
                button.disabled = false;
                loader.style.display = 'none';
                text.textContent = 'Se connecter';
            }
        }
        
        async function handleRegister() {
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            document.getElementById('register-email-error').style.display = 'none';
            document.getElementById('register-password-error').style.display = 'none';
            document.getElementById('register-confirm-password-error').style.display = 'none';
            
            let hasError = false;
            
            if (!email || !isValidEmail(email)) {
                document.getElementById('register-email-error').style.display = 'block';
                hasError = true;
            }
            
            if (!password || password.length < 6) {
                document.getElementById('register-password-error').style.display = 'block';
                hasError = true;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').style.display = 'block';
                hasError = true;
            }
            
            if (hasError) return;
            
            const button = document.getElementById('registerBtn');
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            button.disabled = true;
            loader.style.display = 'inline-block';
            text.textContent = 'Inscription...';
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                const userData = {
                    email: user.email,
                    displayName: user.email.split('@')[0],
                    createdAt: serverTimestamp(),
                    satsBalance: 0,
                    currentPlan: 'free',
                    planExpiryDate: null
                };
                
                await setDoc(doc(db, "Users", user.uid), userData);
                
                showLogMessage('register-log', 'Compte créé avec succès ! Connexion...', 'success');
                
            } catch (error) {
                console.error('Erreur d\'inscription:', error);
                
                let errorMessage = 'Erreur lors de l\'inscription';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Un compte existe déjà avec cet email';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Le mot de passe est trop faible';
                }
                
                showLogMessage('register-log', errorMessage, 'error');
                
                button.disabled = false;
                loader.style.display = 'none';
                text.textContent = 'S\'inscrire';
            }
        }
        
        function showLogMessage(elementId, message, type) {
            const logElement = document.getElementById(elementId);
            logElement.textContent = message;
            logElement.className = `log-message ${type}`;
            logElement.style.display = 'block';
            
            setTimeout(() => {
                logElement.style.display = 'none';
                logElement.textContent = '';
                logElement.className = 'log-message';
            }, 5000);
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        function hideVerifyAnimation() {
            const verifyAnimation = document.getElementById('verify-animation');
            if (verifyAnimation) {
                verifyAnimation.style.display = 'none';
            }
        }
        
        function showAuthScreen() {
            hideVerifyAnimation();
            document.getElementById('auth-screen').style.display = 'flex';
        }
        
        function hideAuthScreen() {
            document.getElementById('auth-screen').style.display = 'none';
        }
        
        function showMainApp() {
            hideVerifyAnimation();
            hideAuthScreen();
            showForecastsSection();
        }
        
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                isLoggedIn = true;
                
                addDebugLog(`Utilisateur connecté: ${user.email}`, 'success');
                
                try {
                    const userRef = doc(db, "Users", user.uid);
                    const userDoc = await getDoc(userRef);
                    
                    if (userDoc.exists()) {
                        currentUserData = userDoc.data();
                        addDebugLog('Données utilisateur chargées', 'success');
                    } else {
                        const userData = {
                            email: user.email,
                            displayName: user.email.split('@')[0],
                            createdAt: serverTimestamp(),
                            satsBalance: 0,
                            currentPlan: 'free',
                            planExpiryDate: null
                        };
                        
                        await setDoc(userRef, userData);
                        currentUserData = userData;
                        addDebugLog('Nouveau profil utilisateur créé', 'success');
                    }
                    
                    await initializeAdminCollection();
                    await checkAdminStatus();
                    await loadUserSubscriptionData();
                    await checkSubscriptionExpiry();
                    
                    updateAdminStatus();
                    updateBadges();
                    
                    showMainApp();
                    
                } catch (error) {
                    handleFirestoreError(error, 'chargement des données utilisateur');
                    showMainApp();
                }
                
            } else {
                currentUser = null;
                currentUserData = null;
                isLoggedIn = false;
                isAdmin = false;
                
                addDebugLog('Utilisateur non connecté', 'info');
                
                setTimeout(() => {
                    showAuthScreen();
                }, 1500);
            }
        });
        
        // Make functions globally available for HTML event handlers
        window.deleteEvent = deleteEvent;
        
        document.addEventListener('DOMContentLoaded', function() {
            setupConnectionMonitoring();
            setupUIEvents();
            setupAuthEvents();
            setupTheme();
            setupCardStyles();
            setupDisplayMode();
            
            lastViewedEventTimestamp = localStorage.getItem('parisAllianceLastViewedEvent') ? 
                new Date(parseInt(localStorage.getItem('parisAllianceLastViewedEvent'))) : new Date(0);
        });
    </script>
</body>
</html>
                      
